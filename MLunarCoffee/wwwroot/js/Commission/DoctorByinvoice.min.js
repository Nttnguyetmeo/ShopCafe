function RevenueDoctorInvoiceTreat({DateFrom:i,DateTo:r,BranchID:n,e=0,t=0,f=31,u=7e4,fnSetting_Before:v,fnSetting_Complete:y,fnMaster_Before:c,fnMaster_Complete:l,fnMaster_CountComplete:a,fnDetail_Before:o,fnDetail_Complete:s,fnDetail_CountComplete:h}){RevenueDoctorInvoiceTreat.prototype.settings=this;this.DateFrom=i;this.DateTo=r;this.BranchID=n;this.MyLoad=e;this.CurrentMaster=0;this.MAXDATE=f;this.LIMITLOAD=u;this.XhrRevenueLoad=null;this.IsDocDevide=0;this.IsDocGreater=0;this.IsDocExCost=0;this.IsDocTreatDevide=0;this.IsDocTreatExCost=0;this.IsAssDevide=0;this.IsAssGreater=0;this.IsAssTreatDevide=0;this.IsTeleFirst=0;this.IsTeleExProduct=0;this.IsConDevide=0;this.IsCSKHExFirst=0;this.IsSuppDevide=0;this.DataRevMaster=[];this.DataRevDetail=[];this.fnSetting_Before=v;this.fnSetting_Complete=y;this.fnMaster_Before=c;this.fnMaster_Complete=l;this.fnMaster_CountComplete=a;this.fnDetail_Before=o;this.fnDetail_Complete=s;this.fnDetail_CountComplete=h;this.Init=function(){let n=RevenueDoctorInvoiceTreat.prototype.settings;n.LoadData_Prepare_Report()};this.LoadData_Prepare_Report=function(){try{let n=RevenueDoctorInvoiceTreat.prototype.settings;AjaxJWT(url="/api/Commission/RevenueSettings",data={},async=!0,success=function(t){let i=[];if(t!=""&&t!="null"){i=JSON.parse(t);let r=i[0];n.IsDocDevide=Number(r.Doc_Devide);n.IsDocGreater=Number(r.Doc_Greater);n.IsDocExCost=Number(r.Doc_ExCost)>0?1:0;n.IsDocTreatDevide=Number(r.Docnomoney_Devide);n.IsDocTreatExCost=Number(r.DocTreat_ExCost)>0?1:0;n.IsAssDevide=Number(r.KTVPTM_Devide);n.IsAssGreater=Number(r.KTVPTM_Greater);n.IsTeleFirst=Number(r.TeleSale_First);n.IsTeleExProduct=Number(r.TeleSale_ExProduct);n.IsConDevide=Number(r.Consult_Devide);n.IsCSKHExFirst=Number(r.Cskh_Exfirst);n.IsSuppDevide=Number(r.Support_Devide)}typeof n.fnSetting_Complete=="function"&&n.fnSetting_Complete();n.LoadData_Report()},before=function(){typeof n.fnSetting_Before=="function"&&n.fnSetting_Before()})}catch(n){}};this.LoadData_Report=function(){let n=RevenueDoctorInvoiceTreat.prototype.settings,{BranchID:i,DateFrom:r,DateTo:u,MyLoad:f,MAXDATE:e}=n,o=r+" to "+u,t={};return t.date=o,t.maxdate=e,t.branch=i,AjaxJWT(url="/api/Commission/RevDoctorInvoiceTreat_LoadData",data=JSON.stringify(t),async=!0,success=function(t){if(t!=""&&t!="null"&&t!="0"&&f!=1){let i=JSON.parse(t);typeof n.RevenueMaster_Count=="function"&&n.RevenueMaster_Count(i.Table,i.Table1)}typeof n.fnMaster_Complete=="function"&&n.fnMaster_Complete(t)},before=function(){typeof n.fnMaster_Before=="function"&&n.fnMaster_Before()}),!1};this.RevenueMaster_Count=async function(n,t){new Promise(i=>{let r=RevenueDoctorInvoiceTreat.prototype.settings;r.DataRevMaster=[];let u=[],o=0,f=0;if(t&&t.length>0)for(let n=0;n<t.length;n++){if(t[n].EMP1!=0){let i={};i.emp=t[n].EMP1;i.commission=t[n].Commission1;i.realamount=t[n].Commission1;u.push(i)}if(t[n].EMP2!=0){let i={};i.emp=t[n].EMP2;i.commission=t[n].Commission2;i.realamount=t[n].Commission2;u.push(i)}if(t[n].EMP3!=0){let i={};i.emp=t[n].EMP3;i.commission=t[n].Commission3;i.realamount=t[n].Commission3;u.push(i)}}if(n&&n.length>0)for(let t=0;t<n.length;t++)if(f=n[t].Amount!=0?n[t].Paid*n[t].Amount*n[t].Quantity/n[t].Price:n[t].Paid*n[t].Percent/100,o=f*n[t].RePercent/100,n[t].BS1!=0){let i={};i.emp=n[t].BS1;i.commission=f;i.realamount=o;u.push(i)}var s=[];let e=0;u.reduce(function(n,t){return n[t.emp]||(e=e+1,n[t.emp]={stt:e,emp:t.emp,realamount:0,commission:0,empName:r.RevenueDetail_EmpName(t.emp)},s.push(n[t.emp]),r.DataRevMaster.push(n[t.emp])),n[t.emp].commission+=t.commission,n[t.emp].realamount+=t.realamount,n},{});typeof r.fnMaster_CountComplete=="function"&&r.fnMaster_CountComplete(s);i()})};this.RevenueDetail_Load=function(n){let t=RevenueDoctorInvoiceTreat.prototype.settings;t.CurrentMaster=n;let{BranchID:u,DateFrom:f,DateTo:e,MAXDATE:o,LIMITLOAD:s,XhrRevenueLoad:r}=t;r&&r.readyState!=4&&r.abort();let h=f+" to "+e,i={};return i.date=h,i.maxdate=o,i.limit=s,i.empid=t.CurrentMaster,i.branch=u,r=AjaxJWT(url="/api/Commission/RevDoctorInvoiceTreat_LoadDetail",data=JSON.stringify(i),async=!0,success=function(n){if(typeof t.fnDetail_Complete=="function"&&t.fnDetail_Complete(n),n!="0"){let i=JSON.parse(n),r=i.Table,u=i.Table1,f=r.concat(u);t.RevenueDetail_Count(f)}},before=function(){typeof t.fnDetail_Before=="function"&&t.fnDetail_Before()}),!1};this.RevenueDetail_Count=async function(n){new Promise(t=>{let i=RevenueDoctorInvoiceTreat.prototype.settings;i.DataRevDetail=[];let{CurrentMaster:f}=i,u=0,r=0;if(n&&n.length>0){for(let t=0;t<n.length;t++)r=n[t].Amount!=0?n[t].TotalPaid*n[t].Amount*n[t].Quantity/n[t].Price:n[t].TotalPaid*n[t].Percent/100,u=r*n[t].RePercent/100,f!=0?n[t].Manual_Revenue==1?(n[t].BS1==f&&i.RevenueDetail_Push(n[t],"BS1","RealAmount1",u,r),n[t].BS2==f&&i.RevenueDetail_Push(n[t],"BS2","RealAmount2",u,r),n[t].BS3==f&&i.RevenueDetail_Push(n[t],"BS3","RealAmount3",u,r)):n[t].BS1==f&&i.RevenueDetail_Push(n[t],"BS1","RealAmount1",u,r):n[t].Manual_Revenue==1?(n[t].BS1!=0&&i.RevenueDetail_Push(n[t],"BS1","RealAmount1",u,r),n[t].BS2!=0&&i.RevenueDetail_Push(n[t],"BS2","RealAmount2",u,r),n[t].BS3!=0&&i.RevenueDetail_Push(n[t],"BS3","RealAmount3",u,r)):n[t].BS1!=0&&i.RevenueDetail_Push(n[t],"BS1","RealAmount1",u,r);typeof i.fnDetail_CountComplete=="function"&&i.fnDetail_CountComplete(JSON.parse(JSON.stringify(i.DataRevDetail)))}t()})};this.RevenueDetail_Push=function(n,t,i,r,u){try{let f=JSON.parse(JSON.stringify(n)),e=RevenueDoctorInvoiceTreat.prototype.settings;f.RealAmount=n.Manual_Revenue==0?r:n[i];f.Commission=n.Manual_Revenue==0?u:n[i];f.Emp=n[t];f.Empname=e.RevenueDetail_EmpName(n[t]);f.Empcode=e.RevenueDetail_EmpCode(n[t]);e.DataRevDetail.push(f)}catch(f){}};this.ExportMaster=async function(n){let t=RevenueDoctorInvoiceTreat.prototype.settings,i={stt:"STT",empName:Outlang.Ten_nhan_vien,realamount:Outlang.Tong_tien},r=n!=""?n:Outlang.Doanh_thu_tong_ky_thuat_vien;await exportJsonToExcel(r,t.DataRevMaster,i)};this.ExportDetail=async function(n){let i=RevenueDoctorInvoiceTreat.prototype.settings,t={CustCode:Outlang.Ma_khach_hang,CustName:Outlang.Khach_hang,SourceID:[Outlang.Nguon,n=>Fun_GetName_ByID(RP_DataCustomerSource,n)],DocCode:Outlang.Ma_ho_so,CustPhone:{dataNamePer:"CustPhone",data:[Outlang.So_dien_thoai]},CustCodeOld:Outlang.Ma_khach_hang_cu!=undefined?Outlang.Ma_khach_hang_cu:"Mã khách hàng cũ",CustAge:Outlang.Tuoi!=undefined?Outlang.Tuoi:"Tuổi",CustGender:[Outlang.Gioi_tinh,(n,{CustGender:t})=>t==60?Outlang.Sys_nam:Outlang.Sys_nu1],CustAddress:{dataNamePer:"CustAddress",data:[Outlang.Sys_dia_chi_khach_hang1]},CustCommuneID:{dataNamePer:"CustCommu",data:[Outlang.Phuong_xa??"Phường xã",n=>Fun_GetName_ByID(RP_DataCommune,n)]},CustDistrictID:{dataNamePer:"CustDistrict",data:[Outlang.Quan_huyen??"Quận huyện",n=>Fun_GetName_ByID(RP_DataDistrict,n)]},CustCityID:{dataNamePer:"CustCity",data:[Outlang.Sys_thanh_pho??"Thành phố",n=>Fun_GetName_ByID(RP_DataCity,n)]},Service_Code:Outlang.Ma_dich_vu!=undefined?Outlang.Ma_dich_vu:"Mã dịch vụ",ServiceID:[Outlang.Dich_vu,n=>i.RevenueDetail_ServiceName(n)],ServiceType:Outlang.Loai_dich_vu!=undefined?Outlang.Loai_dich_vu:"Loại dịch vụ",SaleCode:Outlang.Ma_len_don,Qty:Outlang.So_luong,PriceIni:Outlang.Gia_dich_vu!=undefined?Outlang.Gia_dich_vu:"Giá dịch vụ",Detail:[Outlang.Chi_tiet,(n,{TimeTreatIndex:u,TimeTreat:r,TeethType:i,TeethChoosing:t})=>Number(sys_dencos_Main)==1?`${t!=""?Fun_GetTeeth_ByToken(DataTeeth,t,i):""} `:Outlang.Lan_dieu_tri+": "+u+" | "+r],NewPer:[`${Outlang.Hoan_thanh??"Hoàn thành"} %`,(n,{NewPer:t,TimeTreatIndex:r,TimeTreat:i})=>Number(sys_dencos_Main)==1?t:Number(i)!=0?(Number(r)/Number(i)*100).toFixed(2):0],PercentOfService:[`${Outlang.Tong_hoan_thanh??"Tổng hoàn thành"} %`,(n,{TimeTreatIndex:f,TimeTreat:u,TreatDetail:e,PercentOfService:t,TeethChoosing:r,TreatPercentDetail:o,Quantity:i})=>this.RevenueDetail_TreatmentOrPercentService(f,u,e,t,r,o,i)],Empname:Outlang.Nhan_vien,Empcode:Outlang.Ma_nhan_vien??"Mã nhân viên",Commission:Outlang.Hoa_hong,RePercent:Outlang.Phan_tram_doanh_thu,RealAmount:Outlang.Doanh_thu,PaymentPeriod:Outlang.Thu_trong_ky,PaymentService:Outlang.Tong_tien_thu,NumDatePay:[Outlang.Ngay_thanh_toan,n=>ConvertYMDInt_ToDate(n)],Date:[Outlang.Ngay_dieu_tri,n=>ConvertDateTimeUTC_DMY(n)],BranchName:Outlang.Ten_chi_nhanh,Note:Outlang.Ghi_chu_hoa_hong==undefined?"Ghi chú hoa hồng":Outlang.Ghi_chu_hoa_hong,InsurAmount:Outlang.Bao_hiem,TreatContent:Outlang.Noi_dung_dieu_tri!=undefined?Outlang.Noi_dung_dieu_tri:"Nội dung điều trị",Manual_Revenue:Outlang.Thu_cong};t=Checking_TabControl_System_RebuildHeader(t,tableBodyId="dtContentReportBody",PermissionTable_TabControl);let r=n!=""?n:Outlang.Doanh_thu;await exportJsonToExcel(r,i.DataRevDetail,t)};this.RevenueDetail_ServiceName=function(n){try{return RP_DataService[n].Name}catch(t){return""}};this.RevenueDetail_TreatmentOrPercentService=function(n,t,i,r,u,f,e){try{return sys_dencos_Main==0?t!=0?100*n/t:0:i==0?r:u!=""?e!=0?f/e:0:f}catch(o){return 0}};this.RevenueDetail_EmpName=function(n){try{return RP_DataEmployee[n]!=undefined?RP_DataEmployee[n].Name:""}catch(t){return""}};this.RevenueDetail_EmpCode=function(n){try{return RP_DataEmployee[n]!=undefined?RP_DataEmployee[n].Code:""}catch(t){return""}}}