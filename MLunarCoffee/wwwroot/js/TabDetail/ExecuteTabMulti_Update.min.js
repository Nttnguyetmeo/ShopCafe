function Tab_LoadData_Update(){TabCurrentID!="0"&&TabCurrentID!=""?($("#checkboxUsingService").hide(),AjaxLoad(url="/Customer/Service/TabMulti/?handler=LoadDataDetail",data={currentid:TabCurrentID},async=!0,error=function(){notiError_SW()},success=function(n){let t=JSON.parse(n);if(t){if(CurrentDetailTab_=t.Table,CurrentDetailTab_!=undefined&&CurrentDetailTab_.length!=0){validating_unitprice=1;tab_changing_flag=0;final_Discount=Number(CurrentDetailTab_[0].Discount_Amount_Doctor);final_Discount_per=Number(CurrentDetailTab_[0].DiscountForCus);final_Discount_CTKM=Number(CurrentDetailTab_[0].Discount_Amount);final_Discount_CTKM_per=Number(CurrentDetailTab_[0].Discount_Percent);final_PriceRoot=Number(CurrentDetailTab_[0].Price_Root);final_PriceDiscounted=Number(CurrentDetailTab_[0].Price_Discounted);current_PriceDiscounted=Number(CurrentDetailTab_[0].Price_Discounted);final_Discount_Voucher=Number(CurrentDetailTab_[0].Vourcher_Amount);final_Discount_Voucher_per=Number(CurrentDetailTab_[0].Vourcher_Percent);final_Discount_CusGroup_per=Number(CurrentDetailTab_[0].Discount_CusGroup_Percent);final_Discount_CusGroup=Number(CurrentDetailTab_[0].Discount_CusGroup_Amount);final_Discount_Card=Number(CurrentDetailTab_[0].Discount_Amount_Card);final_Discount_CusMem_per=Number(CurrentDetailTab_[0].Discount_CusMem_Percent);final_Discount_CusMem=Number(CurrentDetailTab_[0].Discount_CusMem_Amount);final_PointUsed=Number(CurrentDetailTab_[0].PointUsed);final_DiscountPointUsed=Number(CurrentDetailTab_[0].Discount_Point);final_vatper=Number(CurrentDetailTab_[0].Vatper);final_vatamount=Number(CurrentDetailTab_[0].Vatamount);$("#vat_per").dropdown("clear");$("#vat_per").dropdown("refresh");$("#vat_per").dropdown("set selected",final_vatper);$("#vat_amount").val(final_vatamount);$("#tabpoint_used").val(CurrentDetailTab_[0].PointUsed);$("#tabpoint_used").prop("disabled",!0);$("#Telesale").dropdown("clear");$("#Telesale").dropdown("refresh");$("#Telesale").dropdown("set selected",CurrentDetailTab_[0].Telesale);$("#Telesale2").dropdown("clear");$("#Telesale2").dropdown("refresh");$("#Telesale2").dropdown("set selected",CurrentDetailTab_[0].Telesale2);$("#Consult1").dropdown("clear");$("#Consult1").dropdown("refresh");$("#Consult1").dropdown("set selected",CurrentDetailTab_[0].Consult1);$("#Consult2").dropdown("refresh");$("#Consult2").dropdown("set selected",CurrentDetailTab_[0].Consult2);$("#Consult3").dropdown("refresh");$("#Consult3").dropdown("set selected",CurrentDetailTab_[0].Consult3);$("#Consult4").dropdown("refresh");$("#Consult4").dropdown("set selected",CurrentDetailTab_[0].Consult4);$("#KTV").dropdown("refresh");$("#KTV").dropdown("set selected",CurrentDetailTab_[0].KTV);$("#PatientID").dropdown("refresh");$("#PatientID").dropdown("set selected",CurrentDetailTab_[0].Patient);$("#dateCreatedExt.flatpickr.detail").flatpickr({dateFormat:"d-m-Y H:i",enableTime:!0,defaultDate:new Date(CurrentDetailTab_[0].CreatedDate)});let t=CurrentDetailTab_[0].TeethChoosing.toString(),r=Number(CurrentDetailTab_[0].TeethType),u=Number(CurrentDetailTab_[0].TeethDenture);currentUnitTab=CurrentDetailTab_[0].Unit;CurrentService_Choose=CurrentDetailTab_[0].Service_ID;let n=data_service_root.filter(function(n){return Number(n.ID)==Number(CurrentService_Choose)?!0:!1});for(n!=undefined&&n!=null&&n.length==1&&$("#tabservice_input").val(n[0].Name),OnChange_Services(t),$("#txtEachTabNote").val(formatHTML(CurrentDetailTab_[0].Note)),Load_Teeth_By_Chossing_Service(0,r,u,0),Tab_LoadData_Update_To_Teeth(t),$("#Tab_Service_Quantity").val(Number(CurrentDetailTab_[0].Quantity)),$("#service_timetotreat").val(Number(CurrentDetailTab_[0].TimeToTreatment)),final_PriceUnit=Number(CurrentDetailTab_[0].Price_Unit),$("#service_unit_price").val(final_PriceUnit),Number(CurrentDetailTab_[0].IsChoose)==1?$("#IsCheckUsing").prop("checked",!0):$("#IsCheckUsing").prop("checked",!1),$("#DiscountAmountPer").dropdown("refresh"),final_Discount_per!=0?($("#DiscountAmountPer").dropdown("set selected",1),$("#txtDiscountAmountPer").val(final_Discount_per)):($("#DiscountAmountPer").dropdown("set selected",2),$("#txtDiscountAmountPer").val(final_Discount)),$("#ReasonDiscountID").dropdown("refresh"),$("#ReasonDiscountID").dropdown("set selected",CurrentDetailTab_[0].ReasonDiscountID),Tab_Detail_Loading_Program_By_Service(data_service_root,data_discount,CurrentDetailTab_[0].Service_ID,"ccbdiscountTabCombo"),$("#discountTabCombo").dropdown("refresh"),$("#discountTabCombo").dropdown("set selected",CurrentDetailTab_[0].Discount_ID),Tab_Detail_Loading_Program_By_Service(data_service_root,data_voucher,CurrentDetailTab_[0].Service_ID,"ccbDiscountVoucher"),$("#DiscountVoucherID").dropdown("refresh"),$("#DiscountVoucherID").dropdown("set selected",CurrentDetailTab_[0].Voucher_ID),$("#DiscountVoucherSeries").val(CurrentDetailTab_[0].Voucher_Series),Tab_Detail_Loading_Program_By_Service(data_service_root,data_customer_group,CurrentDetailTab_[0].Service_ID,"ccbDiscountCustomerGroupID"),$("#DiscountCustomerGroupID").dropdown("refresh"),$("#DiscountCustomerGroupID").dropdown("set selected",CurrentDetailTab_[0].Discount_CusGroup_ID),Tab_Detail_Loading_Program_By_Service(data_service_root,data_customer_mem,CurrentDetailTab_[0].Service_ID,"ccbDiscountCustomerMemberID"),$("#DiscountCustomerMemberID").dropdown("refresh"),$("#DiscountCustomerMemberID").dropdown("set selected",CurrentDetailTab_[0].Discount_CusMem_ID),$("#min_payment").val(CurrentDetailTab_[0].Min_Payment),CurrentDetailTab_[0].IsInsurance==1&&($("#TabInsuranceID").dropdown("refresh"),$("#TabInsuranceID").dropdown("set selected",CurrentDetailTab_[0].InsuranceID)),CurrentDetailTab_[0].IsInstallment==1&&($("#check_installment")[0].checked=!0,onTab_Install_Register(),_Installment_Term_Current=Number(CurrentDetailTab_[0].Installment_Term),_Installment_Data_Current=CurrentDetailTab_[0].DataInstallment,data_tab_installment=_Installment_Term_Current,$("#installment_term").val(CurrentDetailTab_[0].Installment_Term),$("#installment_firpaid").val(CurrentDetailTab_[0].PrepayAmount),$("#date_installment").val(CurrentDetailTab_[0].InstallmentDate)),CurrentDetailTab_[0].IsFree==1&&($("#ReasonFreeID").dropdown("refresh"),$("#ReasonFreeID").dropdown("set selected",CurrentDetailTab_[0].ReasonFree_ID)),$("#SourceService").dropdown("refresh"),$("#SourceService").dropdown("set selected",CurrentDetailTab_[0].ID_Source_CustService),current_card_used=Number(CurrentDetailTab_[0].final_CardUsing),data_card_using=CurrentDetailTab_[0].data_card_using!=""?JSON.parse(CurrentDetailTab_[0].data_card_using):[],i=0;i<data_card_using.length;i++){let n=data_card_using[i].CardID;data_tab_card[n]!=undefined&&(data_tab_card[n].ValueIni=data_tab_card[n].ValueIni+data_card_using[i].Amount,data_tab_card[n].ValueUsed=data_tab_card[n].ValueUsed+data_card_using[i].Amount)}for(i=0;i<data_card_using.length;i++){let n=data_card_using[i].CardID;$("#card_detail_"+n)[0].checked=!0}tab_changing_flag=1;validating_unitprice=0;Genre_PaymentReview()}else Genre_PaymentReview();Check_Edit_Condition_Tab(CurrentDetailTab_[0].AmountPaid,CurrentDetailTab_[0].AmountCommission,CurrentDetailTab_[0].ExportSale,t.Table1,t.Table2,CurrentDetailTab_[0].IsProduct,CurrentDetailTab_[0].Unit,CurrentDetailTab_[0].CurrentPercent,CurrentDetailTab_[0].DataInstallment,CurrentDetailTab_[0].TreatIndex)}})):($(".bodyViewEdit .btnSave").show(),UsingConfirmService==1?($("#checkboxUsingService").show(),$("#IsCheckUsing")[0].checked=!0):($("#checkboxUsingService").hide(),$("#IsCheckUsing")[0].checked=!0),OnChange_Using_Service());Tab_Check_View()}function Tab_LoadData_Update_To_Teeth(n){if(n!=""){$("#teethChoosing").show();$("#Tab_Service_Quantity").attr("readonly",!0);var t=document.getElementsByClassName("checkTeeth"),i=n.split(",");for(let n=0;n<t.length;n++)for(let r=0;r<i.length;r++)t[n].value==i[r]&&(t[n].checked=!0)}}function Check_Edit_Condition_Tab(n,t,i,r,u,f,e,o,s,h){Number(n)!=0&&(checking_tab_detail_paid=Number(n));Number(t)!=0&&(checking_tab_detail_paidcom=Number(t));checking_tab_detail_export_sale=Number(i);checking_tab_detail_labo=u;checking_tab_detail_treat=r;Check_Edit_Condition_Tab_Disable_By_Installement(s)?($("#Tab_Service_Quantity").prop("disabled",!0),$("#check_installment").attr("disabled",!0),$("#installment_term").prop("disabled",!0),$("#installment_firpaid").prop("disabled",!0),$("#date_installment").prop("disabled",!0),$(".checkTeeth").each(function(){$(this).prop("disabled",!0)}),$("#discountTabCombo").addClass("disabled"),$("#DiscountVoucherID").addClass("disabled"),$("#DiscountCustomerGroupID").addClass("disabled"),$("#txtDiscountAmountPer").prop("disabled",!0),$("#DiscountAmountPer").addClass("disabled"),$("#ReasonFreeID").addClass("disabled")):(checking_tab_detail_export_sale!=0||checking_tab_detail_labo.length!=0||checking_tab_detail_treat.length!=0)&&(checking_tab_detail_export_sale!=0?$("#Tab_Service_Quantity").prop("disabled",!0):Number(f)==0?(sys_DentistCosmetic=="1"?((Number(e)==1||Number(e)==2)&&(Check_Edit_Condition_Tab_Disable_By_Labo(checking_tab_detail_labo),Check_Edit_Condition_Tab_Disable_By_Treat(checking_tab_detail_treat)),dataServiceTab=data_service_root.filter(n=>Number(n.Unit)==Number(e)),data_service_root=dataServiceTab,checking_tab_changing_service=1):h!=undefined&&h!=0&&$("#tabmulti_treatedindex").html(Outlang.Da_dieu_tri+" : "+formatNumber(h)),dataServiceTab=data_service_root.filter(n=>n.IsProduct=="0"),data_service_root=dataServiceTab):(dataServiceTab=data_service_root.filter(n=>n.IsProduct=="1"),data_service_root=dataServiceTab))}function Check_Edit_Condition_Tab_Disable_By_Installement(n){try{let i=!1,t=JSON.parse(n);if(t!=undefined&&t.length>0){let n=t.filter(n=>Number(n.paid)>0);n!=undefined&&n.length>0&&(i=!0)}return i}catch(t){return!1}}function Check_Edit_Condition_Tab_Disable_By_Labo(n){let i=0;var r=document.getElementsByClassName("checkTeeth");let t,u;for(j=0;j<n.length;j++){t=n[j].TeethLabo;t!=""&&t.substring(0,1)!=","&&(t=","+t);for(let n=0;n<r.length;n++)u=","+r[n].value+",",t.includes(u)&&(r[n].disabled=!0,i=i+1)}i>0&&($("#adult_tab_teeth_type").attr("disabled",!0),$("#child_tab_teeth_type").attr("disabled",!0),$("#no_select_tab_teeth_type").attr("disabled",!0))}function Check_Edit_Condition_Tab_Disable_By_Treat(n){let i=0;var r=document.getElementsByClassName("checkTeeth");let t,u;for(j=0;j<n.length;j++){t=n[j].TeethTreate;t!=""&&t.substring(0,1)!=","&&(t=","+t);for(let n=0;n<r.length;n++)u=","+r[n].value+",",t.includes(u)&&(r[n].disabled=!0,i=i+1)}i>0&&($("#adult_tab_teeth_type").attr("disabled",!0),$("#child_tab_teeth_type").attr("disabled",!0),$("#no_select_tab_teeth_type").attr("disabled",!0))}function Check_Edit_Condition_Tab_Amount(n){let t="0";if(TabCurrentID!="0"){let i=Number(n.Price_Discounted);(checking_tab_detail_paid!=-1||checking_tab_detail_paidcom!=-1)&&(i<checking_tab_detail_paid||i<checking_tab_detail_paidcom)&&(t="1")}return t}