function Face_Load_Time(){AjaxLoad(url="/Facebook/Messenger/?handler=Face_Load_Time",data={page:face_value_current_page,client:face_value_current_client},async=!0,error=null,success=function(n){n!="0"&&Face_Render_Time(JSON.parse(n),"face_ticket_time")})}function Face_Render_Time(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i],r='<li class="clearfix"><div class="message-data align-right"><span class="message-data-time">'+ConvertDateTimeToStringDMY_HM(t.created)+'<\/span><span class="message-data-name">'+t.username+'<\/span> <i class="icon circle me"><\/i><\/div><div class="message other-message float-right">'+ConvertDateTimeToStringDMY_HM(t.callbacktime)+"<\/div><\/li>";u=u+r}document.getElementById(t).innerHTML=u}}function Face_Load_Note(){AjaxLoad(url="/Facebook/Messenger/?handler=Face_Load_Note",data={page:face_value_current_page,client:face_value_current_client},async=!0,error=null,success=function(n){n!="0"&&Face_Render_Note(JSON.parse(n),"face_ticket_note")})}function Face_Render_Note(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i],r='<li class="clearfix"><div class="message-data align-right"><span class="message-data-time">'+ConvertDateTimeToStringDMY_HM(t.created)+'<\/span><span class="message-data-name">'+t.username+'<\/span> <i class="icon circle me"><\/i><\/div><div class="message other-message float-right">'+t.content+"<\/div><\/li>";u=u+r}document.getElementById(t).innerHTML=u}}function Face_Update_Design_Staff(n,t,i){try{$("#"+n).attr("data_staff",t);face_data_conversation_list[n].staff=t;face_data_conversation_list[n].staffname=i;$("#staffname_"+n).html(i)}catch(r){}}function Face_Update_Design_Ticket(n,t){try{$("#"+n).attr("data_ticket",t);face_data_conversation_list[n].ticket=t;$("#_img_profile_"+n).show()}catch(i){}}function Face_Update_Design_ServiceCare(n,t){try{$("#"+n).attr("data_servicecare",t);face_data_conversation_list[n].servicecare=t}catch(i){}}function Face_Update_Design_Discount(n,t,i){try{$("#"+n).attr("data_discount",t);$("#"+n).attr("data_discountname",i);face_data_conversation_list[n].discount=t;face_data_conversation_list[n].discountname=i}catch(r){}}function Face_Update_Design_Area(n,t){try{$("#"+n).attr("data_area",t);face_data_conversation_list[n].area=t}catch(i){}}function Face_Update_Design_Tag(n,t){try{$("#"+n).attr("data_tag",t);face_data_conversation_list[n].tag=t;let i=Face_Render_Tag(t);$("#tag_"+n).html(i)}catch(i){}}function Face_SaveServiceCare(){let n=$("#ServiceCareFace").dropdown("get value")?$("#ServiceCareFace").dropdown("get value"):"";n!=null&&facebook_begin_save_ticket==1&&face_value_current_mess_post=="MESS"&&AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveServiceCare",data={page:face_value_current_page,client:face_value_current_client,servicecare:n},async=!0,error=function(){Face_Noti_Failure_Execute_Ticket()},success=function(t){t=="0"?Face_Noti_Failure_Execute_Ticket():(Face_Noti_Success_Execute_Ticket(),Face_Update_Design_ServiceCare(face_value_current_conver_id,n))})}function Face_SaveArea(){let n=Number($("#AreaFace").dropdown("get value"))?Number($("#AreaFace").dropdown("get value")):0;n!=0&&facebook_begin_save_ticket==1&&face_value_current_mess_post=="MESS"&&AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveArea",data={page:face_value_current_page,client:face_value_current_client,area:n},async=!0,error=function(){Face_Noti_Failure_Execute_Ticket()},success=function(t){t=="0"?Face_Noti_Failure_Execute_Ticket():(Face_Noti_Success_Execute_Ticket(),Face_Update_Design_Area(face_value_current_conver_id,n))})}function Face_SaveDiscount(){let n=$("#DiscountFace").dropdown("get value")?$("#DiscountFace").dropdown("get value"):0,t=$("#DiscountFace").dropdown("get text")?$("#DiscountFace").dropdown("get text"):0;face_value_current_mess_post=="MESS"&&facebook_begin_save_ticket==1&&AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveDiscount",data={page:face_value_current_page,client:face_value_current_client,discount:n},async=!0,error=function(){Face_Noti_Failure_Execute_Ticket()},success=function(i){i=="0"?Face_Noti_Failure_Execute_Ticket():(Face_Noti_Success_Execute_Ticket(),Face_Update_Design_Discount(face_value_current_conver_id,n,t))})}function Face_SaveStaff(){let n=$("#DectectStaffOnConver").dropdown("get value")?$("#DectectStaffOnConver").dropdown("get value"):0,t=$("#DectectStaffOnConver").dropdown("get text")?$("#DectectStaffOnConver").dropdown("get text"):0;face_value_current_mess_post=="MESS"&&facebook_begin_save_ticket==1&&AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveStaff",data={page:face_value_current_page,client:face_value_current_client,staff:n},async=!0,error=function(){Face_Noti_Failure_Execute_Ticket()},success=function(i){i=="0"?Face_Noti_Failure_Execute_Ticket():(Face_Noti_Success_Execute_Ticket(),Face_Update_Design_Staff(face_value_current_conver_id,n,t))})}function Face_SaveTag(){$(".facebooktag").change(function(){if(face_value_current_mess_post=="MESS"&&facebook_begin_save_ticket==1){let t="";var n=document.getElementsByClassName("facebooktag");for(let i=0;i<n.length;i++)n[i].checked&&(t=t+n[i].value+",");AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveTag",data={page:face_value_current_page,client:face_value_current_client,tag:t},async=!0,error=function(){Face_Noti_Failure_Execute_Ticket()},success=function(n){n=="0"?Face_Noti_Failure_Execute_Ticket():(Face_Noti_Success_Execute_Ticket(),facebook_begin_save_ticket=0,Face_Update_Design_Tag(face_value_current_conver_id,t),facebook_begin_save_ticket=1)})}})}function Face_SaveNote(){let n=$("#txtFace_Note").val().trim();$("#txtFace_Note").val("");n!=""&&facebook_begin_save_ticket==1&&face_value_current_mess_post=="MESS"&&AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveNote",data={page:face_value_current_page,client:face_value_current_client,note:n},async=!0,error=function(){notiError()},success=function(n){n=="0"?notiError():Face_Load_Note()})}function Face_SaveCallBackTime(){let n=$("#Date_from_call_back").val()?$("#Date_from_call_back").val():"";facebook_begin_save_ticket==1&&face_value_current_mess_post=="MESS"&&AjaxLoad(url="/Facebook/Messenger/?handler=Face_SaveCallBackTime",data={page:face_value_current_page,client:face_value_current_client,callbacktime:n},async=!0,error=function(){notiError()},success=function(n){n=="0"?notiError():Face_Load_Time()})}function Face_Noti_Success_Execute_Ticket(){let n=document.getElementById("face_noti_success");n.classList.remove("show");void n.offsetWidth;n.classList.add("show")}function Face_Noti_Failure_Execute_Ticket(){let n=document.getElementById("face_noti_failure");n.classList.remove("show");void n.offsetWidth;n.classList.add("show")}function Face_Fill_Data_When_Click_Page(n){if(face_data_load_initialize_page!=undefined){let t=face_data_load_initialize_page[n];$("#namePageCurrent_Executing").html(t.name);$("#avatarPageCurrent_Executing").attr("src",face_link_image_fanpage.replace("{keycode}",n))}}function Face_Fill_Data_When_Click_Comment(n){facebook_begin_save_ticket=0;$("#DectectStaffOnConver").hide();$("#ticketinfoLink").hide();$("#ticketinfoFace").hide();$("#profile_pageID").html(face_value_current_page);$("#profile_PSID").html(face_value_current_client);$("#face_name").html(face_value_current_client_name);$("#face_email").html(face_value_current_client_name);Face_Load_Image_Asyn("profile_Avatar",n);facebook_begin_save_ticket=1}function Face_Fill_Data_When_Click_Message(n,t,i,r,u,f,e,o){facebook_begin_save_ticket=0;$("#profile_pageID").html(face_value_current_page);$("#profile_PSID").html(face_value_current_client);$("#face_name").html(face_value_current_client_name);$("#face_email").html(face_value_current_client_name);Face_Load_Image_Asyn("profile_Avatar",o);Face_Fill_Data_When_Click_Message_Tag(n);Face_Fill_Data_When_Click_Message_Ticket_Info();$("#ServiceCareFace").dropdown("refresh");$("#ServiceCareFace").dropdown("clear");t!=""&&$("#ServiceCareFace").dropdown("set selected",t.split(","));Face_Obj_Datecallback_time.setDate(new Date);$("#txtFace_Note").val("");$("#AreaFace").dropdown("refresh");$("#AreaFace").dropdown("clear");$("#AreaFace").dropdown("set selected",r);$("#DiscountFace").dropdown("refresh");$("#DiscountFace").dropdown("clear");$("#DiscountFace").dropdown("set selected",i);$("#DectectStaffOnConver").dropdown("refresh");$("#DectectStaffOnConver").dropdown("clear");$("#DectectStaffOnConver").dropdown("set selected",e);$("#ticketinfoFace_firsttab").click();$("#ticketinfoFace_notetab").click(function(){Face_Load_Note()});$("#ticketinfoFace_timetab").click(function(){Face_Load_Time()});$("#ticketinfoFace_history").click(function(){Face_Load_Data_History_Comment()});$("#DectectStaffOnConver").show();$("#ticketinfoLink").show();$("#ticketinfoFace").show();face_value_current_client_name==""&&Face_Get_Info_Click(face_value_current_client);facebook_begin_save_ticket=1}function Face_Get_Info_Click(n){let t=facebook_link_get_info_client.replace("{version}",facebook_version);t=t.replace("{client}",n)+"?access_token="+Face_Get_Token_Access_From_PageID(face_value_current_page);$.ajax({url:t,dataType:"json",type:"GET",contentType:"application/json",data:JSON.stringify({}),contentType:"application/json; charset=utf-8","async":!0,error:function(n){n.responseJSON.error.code==10&&Face_Error_API(10,n.responseJSON!=undefined?n.responseJSON.error.message:"")},success:function(n){n!=null&&n!=undefined&&(face_value_current_client_name=n.first_name+n.last_name,$("#clientname_"+face_value_current_conver_id).html(face_value_current_client_name),$("#face_name").html(face_value_current_client_name),$("#face_email").html(face_value_current_client_name))}})}function Face_Event_Ticket_Area(){$("#face_tic_linkface").click(function(){let n=facebook_link_inbox_mail_teamplate.replace("{link}",facebook_link_inbox_mail);window.open(n)})}function Face_Fill_Data_When_Click_Message_Ticket_Info(){$("#ticketinfo").hide();$("#ticketinfoLink").hide();$("#face_tic_blocked").hide();$("#face_tic_un_block").hide();$("#face_area_get_phone").hide();$("#face_tic_profile").unbind();$("#face_tic_ticket").unbind();AjaxLoad(url="/Facebook/Messenger/?handler=Face_Load_TicketInfo",data={page:face_value_current_page,client:face_value_current_client},async=!0,error=null,success=function(n){if(n!="0"){let t=JSON.parse(n);t!=undefined&&t.length==1?($("#profile_name_facebook").html(t[0].name),$("#profile_phone1").html(t[0].phone),$("#profile_phone2").html(t[0].phone2),$("#profile_gender").html(t[0].gender),$("#profile_birthday").html(ConvertDateTimeUTC_DMY(ConvertToDateRemove1900(t[0].birthday))),$("#ticketinfo").show(),$("#face_tic_newticket").hide(),Number(t[0].customer)!=0?($("#face_tic_profile").show(),$("#face_tic_profile").unbind().click(function(){window.open("/Customer/MainCustomer?CustomerID="+Number(t[0].customer)+"&ver="+versionofWebApplication)})):$("#face_tic_profile").hide(),$("#face_tic_ticket").show(),$("#face_tic_ticket").unbind().click(function(){window.open("/Marketing/TicketAction?TicketID="+Number(t[0].ID)+"&ver="+versionofWebApplication)}),Face_Update_Design_Ticket(face_value_current_conver_id,t[0].ID)):($("#ticketinfo").hide(),$("#face_tic_newticket").show(),$("#face_tic_profile").hide(),$("#face_tic_ticket").hide(),$("#face_area_get_phone").show())}else $("#ticketinfo").hide()},sender=null,before=function(){$("#ticketinfoLink").hide()},complete=function(){$("#ticketinfoLink").show()})}function Face_Fill_Data_When_Click_Message_Tag(n){n=","+n+",";let t=document.getElementsByClassName("facebooktag");if(t!=undefined)for(__i=0;__i<t.length;__i++){let i=t[__i].id.replace("tickettag","");i=","+i+",";t[__i].checked=n.includes(i)?!0:!1}}function Face_Load_Data_History_Comment(){AjaxLoad(url="/Facebook/Messenger/?handler=Face_Loading_History_Comment",data={page:face_value_current_page,client:face_value_current_client},async=!0,error=null,success=function(n){if(n!="0"){let i=JSON.parse(n).Table;Face_Render_History_Comment(i,"history_comment_div");let t=JSON.parse(n).Table1,r=ConvertDateTimeUTC_Time_DOWFULLDAY(t[0].starttime),u=ConvertDateTimeUTC_Time_DOWFULLDAY(t[0].closettime);$("#face_history_begin_chat").html(r);$("#face_history_closed_chat").html(u)}})}function Face_Render_History_Comment(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t="",r=n[i],e=ConvertDateTimeUTC_Time_DOWFULLDAY(r.created),f="";i%2!=0&&(f="history_face_comment_event");t='<div class="history_face_comment '+f+'"><a target="_blank" href="'+r.url+'">'+e+"<\/a><\/div>";u=u+t}document.getElementById(t).innerHTML=u}}function Face_Render_Message_Having_Phone(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length&&i<5;i++){let t=n[i],r=ConvertDateTimeUTC_Time_DOWFULLDAY(t.created_time);u=u+Face_Render_Message_Having_Phone_Each(r,t.phone)}document.getElementById(t).innerHTML=u}}function Face_Render_Message_Having_Phone_Each(n,t){return'<li class="clearfix"><div class="message-data align-right" style="height: 20px;margin-bottom: 0px !important;"><span class="message-data-time get_phone_phone_label_face">'+n+'<\/span><\/div><div class="get_phone_phone_item_face">'+t+"<\/div><\/li>"}function Face_Event_Click_Create_Ticket(){$(".get_phone_phone_item_face").on("click",function(){let n=this.innerHTML,t=$("#ServiceCareFace").dropdown("get value")?$("#ServiceCareFace").dropdown("get value"):"";return $("#DetailModal_Content").html(""),$("#DetailModal_Content").load("/Marketing/TicketDetail?phone="+n+"&name="+encodeURI(face_value_current_client_name)+"&faceid="+face_value_current_client+"&KeyPage="+face_value_current_page+"&servicecare="+t+"&ver="+versionofWebApplication),$("#DetailModal").modal("show"),!1})}function Face_Event_NewTicket_Area(){$("#face_tic_newticket").click(function(){let n=$("#ServiceCareFace").dropdown("get value")?$("#ServiceCareFace").dropdown("get value"):"";return $("#DetailModal_Content").html(""),$("#DetailModal_Content").load("/Marketing/TicketDetail?name="+encodeURI(face_value_current_client_name)+"&faceid="+face_value_current_client+"&KeyPage="+face_value_current_page+"&servicecare="+n+"&ver="+versionofWebApplication),$("#DetailModal").modal("show"),!1})}function Face_Load_Ticket_Profile(){Face_Fill_Data_When_Click_Message_Ticket_Info()}