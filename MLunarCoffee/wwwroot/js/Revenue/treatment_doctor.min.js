function Revenue_Executing_Method(n,t){let r=[],f=n.Table,u=n.Table1;if(report_depentamount==1){let t=n.Table2;Array.prototype.push.apply(r,f);Array.prototype.push.apply(r,t)}else r=f;for(Number(t)!=0&&(r=r.filter(n=>n.BranchID==Number(t)),u=u.filter(n=>n.BranchID==Number(t))),i=0;i<r.length;i++)r[i].BS1+r[i].BS2+r[i].BS3+r[i].BS4!=0&&(r[i].AmountForThisTreatment=sys_dencos_Main==0?(r[i].TimeTreat!=0?r[i].Price/r[i].TimeTreat:0)*r[i].TimeTreatIndex:r[i].Price/100*r[i].PercentOfService,r[i].IsRevenue=Number(r[i].AmountForThisTreatment)<=Number(r[i].TotalPay)?1:0,r[i].Revenue=sys_dencos_Main==0?r[i].AmountForThisTreatment/r[i].TimeTreatIndex:r[i].Price/100*r[i].NewPer,r[i].NumPerson=(r[i].BS1!=0?1:0)+(r[i].BS2!=0?1:0)+(r[i].BS3!=0?1:0)+(r[i].BS4!=0?1:0),r[i].RevenueFor1Treatment=report_depentamount==0?r[i].Revenue:r[i].IsRevenue==1?r[i].Revenue:0,r[i].RealAmount1=Detail_Executing_GetRevenue(r[i].NumPerson,r[i].Permision_Percent_Serivice,r[i].Permision_Amount_Serivice,r[i].Permision_Percent,r[i].Permision_Amount,r[i].Price,r[i].CardAmountUsing,r[i].Quantity,r[i].NewPer,r[i].RevenueFor1Treatment,1),r[i].RealAmount2=Detail_Executing_GetRevenue(r[i].NumPerson,r[i].Permision_Percent_Serivice,r[i].Permision_Amount_Serivice,r[i].Permision_Percent,r[i].Permision_Amount,r[i].Price,r[i].CardAmountUsing,r[i].Quantity,r[i].NewPer,r[i].RevenueFor1Treatment,0),r[i].RealAmount3=Detail_Executing_GetRevenue(r[i].NumPerson,r[i].Permision_Percent_Serivice,r[i].Permision_Amount_Serivice,r[i].Permision_Percent,r[i].Permision_Amount,r[i].Price,r[i].CardAmountUsing,r[i].Quantity,r[i].NewPer,r[i].RevenueFor1Treatment,0),r[i].RealAmount4=Detail_Executing_GetRevenue(r[i].NumPerson,r[i].Permision_Percent_Serivice,r[i].Permision_Amount_Serivice,r[i].Permision_Percent,r[i].Permision_Amount,r[i].Price,r[i].CardAmountUsing,r[i].Quantity,r[i].NewPer,r[i].RevenueFor1Treatment,0));dataDetail=r;dataDetail_manual=u;RenderReportMaster(report_EmployeeData,"dtContentReportMasterBody");$(".masterRow")[0]&&$(".masterRow")[0].click()}function Detail_Executing_GetRevenue(n,t,i,r,u,f,e,o,s,h,c){let y=0,p=0,a=0,l=0,k=0,v=0,w=0,b=0;return c==1&&r+u>0?(a=r,l=u,v=1):c==0&&r+u>0?v=-1:(a=t,l=i,v=0),p=report_depentamount==0?f+e:f,v==-1?y=0:(w=l!=0?l*(sys_dencos_Main==1?o:1):sys_dencos_Main==0?p*a/100/o:p*a/100*s/100,h>0&&(b=l!=0?l*(sys_dencos_Main==1?o:1):h*a/100),v==1?(k=report_depentamount==0?w:b,y=k):y=Detail_GetRevenue_ByType(n,b,w,c)),y}function Detail_GetRevenue_ByType(n,t,i,r){return report_depentamount==0?report_way_to_count==1?n==0?0:i/n:report_way_to_count==2?r==1?i:0:i:report_way_to_count==1?n==0?0:t/n:report_way_to_count==2?r==1?t:0:t}function RenderReportMaster_TimeJoin(n){let t=0;for(_i=0;_i<dataDetail.length;_i++)(dataDetail[_i].BS1==n||dataDetail[_i].BS2==n||dataDetail[_i].BS3==n||dataDetail[_i].BS4==n)&&(t=t+1);for(_i=0;_i<dataDetail_manual.length;_i++)(dataDetail_manual[_i].EMP1==n||dataDetail_manual[_i].EMP2==n||dataDetail_manual[_i].EMP3==n)&&(t=t+1);return t}function RenderReportMaster_Amount(n){let t=0;for(_i=0;_i<dataDetail.length;_i++)dataDetail[_i].BS1==n&&(t=t+dataDetail[_i].RealAmount1),dataDetail[_i].BS2==n&&(t=t+dataDetail[_i].RealAmount2),dataDetail[_i].BS3==n&&(t=t+dataDetail[_i].RealAmount3),dataDetail[_i].BS4==n&&(t=t+dataDetail[_i].RealAmount4);for(_i=0;_i<dataDetail_manual.length;_i++)dataDetail_manual[_i].EMP1==n&&(t=t+dataDetail_manual[_i].Commission1),dataDetail_manual[_i].EMP2==n&&(t=t+dataDetail_manual[_i].Commission2),dataDetail_manual[_i].EMP3==n&&(t=t+dataDetail_manual[_i].Commission3);return t}function RenderReportMaster_PAID(n){let t=0;for(_i=0;_i<dataDetail.length;_i++)dataDetail[_i].BS1==n&&(t=t+dataDetail[_i].PaidInPeriod),dataDetail[_i].BS2==n&&(t=t+dataDetail[_i].PaidInPeriod),dataDetail[_i].BS3==n&&(t=t+dataDetail[_i].PaidInPeriod),dataDetail[_i].BS4==n&&(t=t+dataDetail[_i].PaidInPeriod);return t}function RenderReportMaster(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="",f=0;if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i],e=RenderReportMaster_TimeJoin(t.ID),r=RenderReportMaster_Amount(t.ID),o=RenderReportMaster_PAID(t.ID);if(e!=0){f=f+r;let n=Fun_GetObject_ByID(DataEmployee,t.ID),i='<td class="d-none">'+t.ID+'<\/td><td class="d-none">'+t.Name+'<\/td><td class="vt-number-order"><\/td><td><div class="d-flex"><div class="icon icon-shape icon-sm me-2 text-center"><img class="avatar avatar-xs mt-2" src="'+n.Avatar+'" alt="label-image"><\/div><div class="d-flex flex-column"><h6 class="text-dark text-sm mb-0">'+t.Name+'<\/h6><span class="text-xs">'+formatNumber(Math.ceil(r))+"<\/span> <\/div><\/div><\/td>";u=u+'<tr class="vt-number masterRow" data-items="'+e+'" data-amount="'+r+'" data-name="'+t.Name+'" data-id="'+t.ID+'">'+i+"<\/tr>"}}Count_Up("lbTotalAmount",f);document.getElementById(t).innerHTML=u;EventrowClick()}}function ViewDetail(n,t,i){let r=dataDetail.filter(t=>t.BS1==n||t.BS2==n||t.BS3==n||t.BS4==n),u=dataDetail_manual.filter(t=>t.EMP1==n||t.EMP2==n||t.EMP3==n);r!=undefined&&u!=undefined&&(Count_Up("lbTotalAmount_Detail",i),Count_Up("lbTotalTimes_Detail",t),RenderReportDetail(r,u,"dtContentReportBody",n))}function RenderReportDetail(n,t,i,r){var u=document.getElementById(i);if(u!=null){u.innerHTML="";let f="",e=0;if(n&&n.length>0)for(let t=0;t<n.length;t++){e=t;let i=n[t],u='<td class="vt-number-order"><\/td><td>'+ConvertDateTimeUTC_DMY(i.TreatmentDate)+'<\/td><td><a target="_blank" href="/Customer/MainCustomer?CustomerID='+i.CustID+"&ver="+versionofWebApplication+'">'+i.CustCode+"<\/a><\/td><td>"+i.CustName+'<\/td><td style="text-align:center">'+(Number(i.IsCustNew)==1?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':'<i class="imgGrid vtt-icon vttech-icon-uncheck"><\/i>')+"<\/td><td>"+RenderReport_Detail_Get_ServiceName(i.ServiceID)+(Number(sys_dencos_Main)==1?'<span class="statustreat_row">'+(i.NewPer+" % làm mới")+"<\/span>":'<span class="statustreat_row">'+("Lần điều trị : "+i.TimeTreatIndex+" | "+i.TimeTreat)+"<\/span>")+"<\/td><td>"+formatNumber(i.PriceRoot)+"<\/td><td>"+Math.ceil(i.PerDiscount)+" %"+(Number(i.CardAmountUsing)!=0?'<span class="statustreat_row"> Sử Dụng Thẻ: '+formatNumber(i.CardAmountUsing)+"<\/span>":"")+"<\/td><td>"+formatNumber(i.Price)+"<\/td><td>"+formatNumber(i.TotalPay)+'<\/td><td style="text-align:center"><span class="money_row">'+formatNumber(i.PaidInPeriod)+"<\/span><\/td><td>"+formatNumber(i.Price-i.TotalPay)+'<\/td><td><span class="statustreat_row">'+(Number(sys_dencos_Main)==1?i.Treat_Percent:Math.ceil(i.TimeTreatIndex/i.TimeTreat*100))+' %<\/span><\/td><td style="text-align:center">'+(Number(i.IsRevenue)==1?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':'<i class="imgGrid vtt-icon vttech-icon-uncheck"><\/i>')+'<\/td><td><span class="money_row">'+formatNumber(Math.ceil((i.BS1!=r?0:i.RealAmount1)+(i.BS2!=r?0:i.RealAmount2)+(i.BS3!=r?0:i.RealAmount3)+(i.BS4!=r?0:i.RealAmount4)))+'<\/span><\/td><td style="text-align:center">'+(Number(i.Manual_Revenue)==1?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':"")+"<\/td>";f=f+(Number(i.Before_Revenue)==0?'<tr role="row" class="vt-number">':'<tr role="row" class="vt-number outrangerow">')+u+"<\/tr>"}if(t&&t.length>0)for(let n=0;n<t.length;n++){let i=t[n],u='<td class="vt-number-order"><\/td><td>'+ConvertDateTimeUTC_DMY(i.TreatmentDate)+'<\/td><td><a target="_blank" href="/Customer/MainCustomer?CustomerID='+i.CustID+"&ver="+versionofWebApplication+'">'+i.CustCode+"<\/a><\/td><td>"+i.CustName+'<\/td><td style="text-align:center">'+(Number(i.IsCustNew)==1?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':'<i class="imgGrid vtt-icon vttech-icon-uncheck"><\/i>')+"<\/td><td>"+RenderReport_Detail_Get_ServiceName(i.ServiceID)+(Number(sys_dencos_Main)==1?'<span class="statustreat_row">'+(i.NewPer+" % làm mới")+"<\/span>":'<span class="statustreat_row">'+("Lần điều trị : "+i.TimeTreatIndex+" | "+i.TimeTreat)+"<\/span>")+"<\/td><td>"+formatNumber(i.PriceRoot)+"<\/td><td>"+i.PerDiscount+" %"+(Number(i.CardAmountUsing)!=0?'<span class="statustreat_row"> Sử Dụng Thẻ: '+formatNumber(i.CardAmountUsing)+"<\/span>":"")+"<\/td><td>"+formatNumber(i.Price)+"<\/td><td>"+formatNumber(i.TotalPay)+"<\/td><td>"+formatNumber(i.Price-i.TotalPay)+"<\/td><td>"+i.Treat_Percent+' %<\/td><td style="text-align:center">'+(Number(i.IsRevenue)==1?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':'<i class="imgGrid vtt-icon vttech-icon-uncheck"><\/i>')+'<\/td><td><span class="money_row">'+formatNumber(Math.ceil((i.EMP1!=r?0:i.Commission1)+(i.EMP2!=r?0:i.Commission2)+(i.EMP3!=r?0:i.Commission3)))+"<\/td><td>"+ConvertDateTimeUTC_DMY(i.Manual_Revenue_Date)+'<\/td><td style="text-align:center">'+(Number(i.Manual_Revenue)==1?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':"")+"<\/td>";f=f+(Number(i.Before_Revenue)==0?'<tr class="vt-number" role="row">':'<tr role="row" class="vt-number outrangerow">')+u+"<\/tr>"}document.getElementById(i).innerHTML=f}}function RenderReport_Detail_Get_ServiceName(n){try{return report_ServiceData[n]}catch(t){return""}}