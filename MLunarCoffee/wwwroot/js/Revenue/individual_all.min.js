function Revenue_Executing_Method(n,t){report_data=[];let u=n.Table,f=n.Table2,e=n.Table1,o=n.Table3,s=n.Table4,i=0,r=[],h=u.filter(n=>Number(n.BS1)==Number(employeeID_Selected)||Number(n.BS2)==Number(employeeID_Selected)||Number(n.BS3)==Number(employeeID_Selected)||Number(n.BS4)==Number(employeeID_Selected)),c=f.filter(n=>Number(n.BS1)==Number(employeeID_Selected)||Number(n.BS2)==Number(employeeID_Selected)||Number(n.BS3)==Number(employeeID_Selected)||Number(n.BS4)==Number(employeeID_Selected)),l=e.filter(n=>Number(n.IsDoctor)==1),a=report_rule.DepentAmount_DOC,v=report_rule.WayCount_DOC;i=1;Revenue_Executing_Treat_Detail(employeeID_Selected,i,r,h,c,l,a,v);let y=u.filter(n=>Number(n.PT1)==Number(employeeID_Selected)||Number(n.PT2)==Number(employeeID_Selected)||Number(n.PT3)==Number(employeeID_Selected)||Number(n.PT4)==Number(employeeID_Selected)),p=f.filter(n=>Number(n.PT1)==Number(employeeID_Selected)||Number(n.PT2)==Number(employeeID_Selected)||Number(n.PT3)==Number(employeeID_Selected)||Number(n.PT4)==Number(employeeID_Selected)),w=e.filter(n=>Number(n.IsAssistant)==1),b=report_rule.DepentAmount_ASS,k=report_rule.WayCount_ASS;i=2;Revenue_Executing_Treat_Detail(employeeID_Selected,i,r,y,p,w,b,k);let d=u.filter(n=>Number(n.TECH1)==Number(employeeID_Selected)||Number(n.TECH2)==Number(employeeID_Selected)),g=f.filter(n=>Number(n.TECH1)==Number(employeeID_Selected)||Number(n.TECH2)==Number(employeeID_Selected)),nt=e.filter(n=>Number(n.IsTech)==1),tt=report_rule.DepentAmount_TECH,it=report_rule.WayCount_TECH;i=3;Revenue_Executing_Treat_Detail(employeeID_Selected,i,r,d,g,nt,tt,it);let rt=report_rule.WayCount_CONSUL;i=4;Revenue_Executing_Tab_Detail(employeeID_Selected,i,r,o,s,rt);report_data=r;Number(t)!=0&&(report_data=r.filter(n=>Number(n.BranchID)==Number(t)));Revenue_Load_Data_Indicator(report_data,current_types);Revenue_Render_Data_Report(report_data,"dtContentReportRevenueMasterBody",current_types)}function Revenue_Executing_Treat_Detail(n,t,r,u,f,e,o,s){let l=0,a=0,v=0,y=0,c="",p=0,w=0,b=0,k=0,it=0,d=0,g=0,nt=0,tt=0,h=[];for(o==1?(Array.prototype.push.apply(h,u),Array.prototype.push.apply(h,f)):h=u,i=0;i<h.length;i++){let u={};h[i].AmountForThisTreatment=sys_dencos_Main==0?(h[i].TimeTreat!=0?h[i].Price/h[i].TimeTreat:0)*h[i].TimeTreatIndex:h[i].Price/100*h[i].PercentOfService;h[i].IsRevenue=Number(h[i].AmountForThisTreatment)<=Number(h[i].TotalPay)?1:0;h[i].Revenue=sys_dencos_Main==0?h[i].AmountForThisTreatment/h[i].TimeTreatIndex:h[i].Price/100*h[i].NewPer;switch(t){case 1:p=(h[i].BS1!=0?1:0)+(h[i].BS2!=0?1:0)+(h[i].BS3!=0?1:0)+(h[i].BS4!=0?1:0);d=h[i].BS1;g=h[i].BS2;nt=h[i].BS3;tt=h[i].BS4;l=h[i].BS_Percent_Serivice;a=h[i].BS_Amount_Serivice;v=h[i].BS_Percent;y=h[i].BS_Amount;c="Bác Sĩ";break;case 2:p=(h[i].PT1!=0?1:0)+(h[i].PT2!=0?1:0)+(h[i].PT3!=0?1:0)+(h[i].PT4!=0?1:0);d=h[i].PT1;g=h[i].PT2;nt=h[i].PT3;tt=h[i].PT4;l=h[i].PT_Percent_Serivice;a=h[i].PT_Amount_Serivice;v=h[i].PT_Percent;y=h[i].PT_Amount;c="Phụ Tá";break;case 3:p=(h[i].TECH1!=0?1:0)+(h[i].TECH2!=0?1:0);d=h[i].TECH1;g=h[i].TECH2;nt=0;tt=0;l=h[i].TECH_Percent_Serivice;a=h[i].TECH_Amount_Serivice;v=h[i].TECH_Percent;y=h[i].TECH_Amount;c="HT Chuyên Môn"}h[i].RevenueFor1Treatment=o==0?h[i].Revenue:h[i].IsRevenue==1?h[i].Revenue:0;w=d!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,1);b=g!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,0);k=nt!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,0);it=tt!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,0);u.Amount=w+b+k+it;u.ServiceID=h[i].ServiceID;u.Before_Revenue=h[i].Before_Revenue;u.Manual_Revenue=0;u.Date=h[i].TreatmentDate;u.BranchID=h[i].BranchID;u.CustID=h[i].CustID;u.CustCode=h[i].CustCode;u.CustName=h[i].CustName;u.Type=t;u.TypeName=c;r.push(u)}for(i=0;i<e.length;i++){switch(t){case 1:c="Bác Sĩ";break;case 2:c="Phụ Tá";break;case 3:c="HT Chuyên Môn"}let u={};w=e[i].EMP1==n?e[i].Commission1:0;b=e[i].EMP2==n?e[i].Commission2:0;k=e[i].EMP3==n?e[i].Commission3:0;u.Amount=w+b+k;u.ServiceID=e[i].ServiceID;u.Before_Revenue=0;u.Manual_Revenue=1;u.Date=e[i].Manual_Revenue_Date;u.BranchID=e[i].BranchID;u.CustID=e[i].CustID;u.CustCode=e[i].CustCode;u.CustName=e[i].CustName;u.Type=t;u.TypeName=c;r.push(u)}}function Detail_Executing_GetRevenue(n,t,i,r,u,f,e,o,s,h,c,l,a){let w=0,b=0,y=0,v=0,g=0,p=0,k=0,d=0;return a==1&&r+u>0?(y=r,v=u,p=1):a==0&&r+u>0?p=-1:(y=t,v=i,p=0),b=c==0?f+e:f,p==-1?w=0:(k=v!=0?v*(sys_dencos_Main==1?o:1):sys_dencos_Main==0?b*y/100/o:b*y/100*s/100,h>0&&(d=v!=0?v*(sys_dencos_Main==1?o:1):h*y/100),p==1?(g=c==0?k:d,w=g):w=Detail_GetRevenue_ByType(n,d,k,c,l,a)),w}function Detail_GetRevenue_ByType(n,t,i,r,u,f){return r==0?u==1?n==0?0:i/n:u==2?f==1?i:0:i:u==1?n==0?0:t/n:u==2?f==1?t:0:t}function Revenue_Executing_Tab_Detail(n,t,r,u,f,e){let o=u,h=0,c=0,l=0,a=0,s=0;for(i=0;i<o.length;i++){let u={};s=(o[i].EMP1!=0?1:0)+(o[i].EMP2!=0?1:0)+(o[i].EMP3!=0?1:0)+(o[i].EMP4!=0?1:0);h=o[i].EMP1!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,1);c=o[i].EMP2!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,0);l=o[i].EMP3!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,0);a=o[i].EMP4!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,0);u.Amount=h+c+l+a;u.ServiceID=o[i].ServiceID;u.Before_Revenue=0;u.Manual_Revenue=0;u.Date=o[i].Created;u.BranchID=o[i].BranchID;u.CustID=o[i].CustID;u.CustCode=o[i].CustCode;u.CustName=o[i].CustName;u.Type=t;u.TypeName="Tư Vấn";r.push(u)}for(i=0;i<f.length;i++){let u={};h=f[i].EMP1==n?f[i].Commission1:0;c=f[i].EMP2==n?f[i].Commission2:0;l=f[i].EMP3==n?f[i].Commission3:0;u.Amount=h+c+l;u.ServiceID=f[i].ServiceID;u.Before_Revenue=0;u.Manual_Revenue=1;u.Date=f[i].Created;u.BranchID=f[i].BranchID;u.CustID=f[i].CustID;u.CustCode=f[i].CustCode;u.CustName=f[i].CustName;u.Type=t;u.TypeName="Tư Vấn";r.push(u)}}function Detail_Executing_GetRevenue_Consult(n,t,i,r,u,f,e,o,s,h){let a=0,v=0,c=0,l=0,y=0;return h==1&&r+u>0?(v=r,c=u,l=1):h==0&&r+u>0?l=-1:(v=t,c=i,l=0),l==-1?a=0:(y=c!=0?o/f*c*e:o/f*f*v/100,a=Detail_GetRevenue_ByType_Consult(n,y,s,h)),a}function Detail_GetRevenue_ByType_Consult(n,t,i,r){return i==1?n==0?0:t/n:i==2?r==1?t:0:t}function Revenue_Render_Data_Report(n,t,i){var u=document.getElementById(t),r;if(u!=null){u.innerHTML="";let e="",f=n;if(n&&n.length>0&&(i!=""&&(f=n.filter(n=>i.includes(","+n.Type+","))),f&&f.length>0))for(r=0;r<f.length;r++){let n=f[r],t='<td class="vt-number-order"><\/td><td><a href="/Customer/MainCustomer?CustomerID='+n.CustID+"&ver="+versionofWebApplication+'" target="_blank">'+n.CustCode+"<\/a><\/td><td>"+n.CustName+"<\/td><td>"+(Number(n.IsCard)==1?report_CardData[n.ServiceID]:report_ServiceData[n.ServiceID])+"<\/td><td>"+(report_BranchData[n.BranchID]!=undefined?report_BranchData[n.BranchID]:"")+"<\/td><td>"+formatDateToDMYHM(n.Date)+"<\/td><td>"+formatNumber(n.Amount)+'<\/td><td style="text-align:center">'+(n.Manual_Revenue?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':"")+"<\/td><td>"+n.TypeName+"<\/td>";e=e+(Number(n.Before_Revenue)==0?'<tr class="vt-number" role="row">':'<tr role="row" class="vt-number outrangerow">')+t+"<\/tr>"}document.getElementById(t).innerHTML=e}}function Revenue_Load_Data_Indicator(n,t){if(n!=null&&n!=undefined){let i=n;t!=""&&(i=n.filter(n=>t.includes(","+n.Type+",")));let f=i.filter(n=>Number(n.Type)==1).length,e=i.filter(n=>Number(n.Type)==2).length,o=i.filter(n=>Number(n.Type)==3).length,s=i.filter(n=>Number(n.Type)==4).length,h=s+f+e+o,r=Revenue_Total_Amount_By_Type(i,1)+Revenue_Total_Amount_By_Type(i,2)+Revenue_Total_Amount_By_Type(i,3),u=Revenue_Total_Amount_By_Type(i,4),c=r+u;Count_Up("revenue_amount_total",c);Count_Up("revenue_amount_treat",r);Count_Up("revenue_amount_consul",u);Count_Up("revenue_value_time_total",h);$(".revenue_value_count").each(function(){$(this).prop("Counter",0).animate({Counter:$(this).text()},{duration:100,easing:"swing",step:function(n){$(this).text(formatNumber(Math.ceil(n)))}})})}}function Revenue_Total_Amount_By_Type(n,t){let i=0;if(n!=null&&n!=undefined){let r;if(r=t==0?n:n.filter(n=>Number(n.Type)==t),r&&r.length!=0)for(let n=0;n<r.length;n++)i+=Number(r[n].Amount)}return i}function RenderReportMaster(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i];obj=Fun_GetObject_ByID(DataEmployee,t.ID);let r='<td class="d-none">'+t.ID+'<\/td><td class="d-none">'+t.Name+'<\/td><td class="vt-number-order"><\/td><td><div class="d-flex"><div class="icon icon-shape icon-sm me-2 text-center"><img class="avatar avatar-xs mt-2" src="'+obj.Avatar+'" alt="label-image"><\/div><div class="d-flex flex-column"><h6 class="text-dark text-sm mb-0">'+t.Name+'<\/h6><span class="text-xs">'+t.Code+"<\/span> <\/div><\/div><\/td>";u=u+'<tr class="vt-number masterRow" data-id="'+t.ID+'" data-name="'+t.Name+'">'+r+"<\/tr>"}document.getElementById(t).innerHTML=u;EventrowClick()}}