function Revenue_Executing_Method(n){report_data=[];let r=n.Table,u=n.Table2,f=n.Table1,e=n.Table3,o=n.Table4,t=0,i=[],s=r.filter(n=>Number(n.BS1)==Number(sys_employeeID_Main)||Number(n.BS2)==Number(sys_employeeID_Main)||Number(n.BS3)==Number(sys_employeeID_Main)||Number(n.BS4)==Number(sys_employeeID_Main)),h=u.filter(n=>Number(n.BS1)==Number(sys_employeeID_Main)||Number(n.BS2)==Number(sys_employeeID_Main)||Number(n.BS3)==Number(sys_employeeID_Main)||Number(n.BS4)==Number(sys_employeeID_Main)),c=f.filter(n=>Number(n.IsDoctor)==1),l=report_rule.DepentAmount_DOC,a=report_rule.WayCount_DOC;t=1;Revenue_Executing_Treat_Detail(sys_employeeID_Main,t,i,s,h,c,l,a);let v=r.filter(n=>Number(n.PT1)==Number(sys_employeeID_Main)||Number(n.PT2)==Number(sys_employeeID_Main)||Number(n.PT3)==Number(sys_employeeID_Main)||Number(n.PT4)==Number(sys_employeeID_Main)),y=u.filter(n=>Number(n.PT1)==Number(sys_employeeID_Main)||Number(n.PT2)==Number(sys_employeeID_Main)||Number(n.PT3)==Number(sys_employeeID_Main)||Number(n.PT4)==Number(sys_employeeID_Main)),p=f.filter(n=>Number(n.IsAssistant)==1),w=report_rule.DepentAmount_ASS,b=report_rule.WayCount_ASS;t=2;Revenue_Executing_Treat_Detail(sys_employeeID_Main,t,i,v,y,p,w,b);let k=r.filter(n=>Number(n.TECH1)==Number(sys_employeeID_Main)||Number(n.TECH2)==Number(sys_employeeID_Main)),d=u.filter(n=>Number(n.TECH1)==Number(sys_employeeID_Main)||Number(n.TECH2)==Number(sys_employeeID_Main)),g=f.filter(n=>Number(n.IsTech)==1),nt=report_rule.DepentAmount_TECH,tt=report_rule.WayCount_TECH;t=3;Revenue_Executing_Treat_Detail(sys_employeeID_Main,t,i,k,d,g,nt,tt);let it=report_rule.WayCount_CONSUL;t=4;Revenue_Executing_Tab_Detail(sys_employeeID_Main,t,i,e,o,it);report_data=i;Revenue_Load_Data_Indicator(report_data);Revenue_Render_Data_Report(report_data,"dtContentReportRevenueMasterBody",0)}function Revenue_Executing_Treat_Detail(n,t,r,u,f,e,o,s){let l=0,a=0,v=0,y=0,c="",p=0,w=0,b=0,k=0,it=0,d=0,g=0,nt=0,tt=0,h=[];for(o==1?Array.prototype.push.apply(h,u,f):h=u,i=0;i<h.length;i++){let u={};h[i].AmountForThisTreatment=sys_dencos_Main==0?(h[i].TimeTreat!=0?h[i].Price/h[i].TimeTreat:0)*h[i].TimeTreatIndex:h[i].Price/100*h[i].PercentOfService;h[i].IsRevenue=Number(h[i].AmountForThisTreatment)<=Number(h[i].TotalPay)?1:0;h[i].Revenue=sys_dencos_Main==0?h[i].AmountForThisTreatment/h[i].TimeTreatIndex:h[i].Price/100*h[i].NewPer;switch(t){case 1:p=(h[i].BS1!=0?1:0)+(h[i].BS2!=0?1:0)+(h[i].BS3!=0?1:0)+(h[i].BS4!=0?1:0);d=h[i].BS1;g=h[i].BS2;nt=h[i].BS3;tt=h[i].BS4;l=h[i].BS_Percent_Serivice;a=h[i].BS_Amount_Serivice;v=h[i].BS_Percent;y=h[i].BS_Amount;c="Bác Sĩ";break;case 2:p=(h[i].PT1!=0?1:0)+(h[i].PT2!=0?1:0)+(h[i].PT3!=0?1:0)+(h[i].PT4!=0?1:0);d=h[i].PT1;g=h[i].PT2;nt=h[i].PT3;tt=h[i].PT4;l=h[i].PT_Percent_Serivice;a=h[i].PT_Amount_Serivice;v=h[i].PT_Percent;y=h[i].PT_Amount;c="Phụ Tá";break;case 3:p=(h[i].TECH1!=0?1:0)+(h[i].TECH2!=0?1:0);d=h[i].TECH1;g=h[i].TECH2;nt=0;tt=0;l=h[i].TECH_Percent_Serivice;a=h[i].TECH_Amount_Serivice;v=h[i].TECH_Percent;y=h[i].TECH_Amount;c="HT Chuyên Môn"}h[i].RevenueFor1Treatment=o==0?h[i].Revenue:h[i].IsRevenue==1?h[i].Revenue:0;w=d!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,1);b=g!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,0);k=nt!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,0);it=tt!=n?0:Detail_Executing_GetRevenue(p,l,a,v,y,h[i].Price,h[i].CardAmountUsing,h[i].Quantity,h[i].NewPer,h[i].RevenueFor1Treatment,o,s,0);u.Amount=w+b+k+it;u.ServiceID=h[i].ServiceID;u.Before_Revenue=h[i].Before_Revenue;u.Manual_Revenue=0;u.Date=h[i].TreatmentDate;u.BranchID=h[i].BranchID;u.CustID=h[i].CustID;u.CustCode=h[i].CustCode;u.CustName=h[i].CustName;u.Type=t;u.TypeName=c;r.push(u)}for(i=0;i<e.length;i++){switch(t){case 1:c="Bác Sĩ";break;case 2:c="Phụ Tá";break;case 3:c="HT Chuyên Môn"}let u={};w=e[i].EMP1==n?e[i].Commission1:0;b=e[i].EMP2==n?e[i].Commission2:0;k=e[i].EMP3==n?e[i].Commission3:0;u.Amount=w+b+k;u.ServiceID=e[i].ServiceID;u.Before_Revenue=0;u.Manual_Revenue=1;u.Date=e[i].Manual_Revenue_Date;u.BranchID=e[i].BranchID;u.CustID=e[i].CustID;u.CustCode=e[i].CustCode;u.CustName=e[i].CustName;u.Type=t;u.TypeName=c;r.push(u)}}function Detail_Executing_GetRevenue(n,t,i,r,u,f,e,o,s,h,c,l,a){let w=0,b=0,y=0,v=0,g=0,p=0,k=0,d=0;return a==1&&r+u>0?(y=r,v=u,p=1):a==0&&r+u>0?p=-1:(y=t,v=i,p=0),b=c==0?f+e:f,p==-1?w=0:(k=v!=0?v*(sys_dencos_Main==1?o:1):sys_dencos_Main==0?b*y/100/o:b*y/100*s/100,h>0&&(d=v!=0?v*(sys_dencos_Main==1?o:1):h*y/100),p==1?(g=c==0?k:d,w=g):w=Detail_GetRevenue_ByType(n,d,k,c,l,a)),w}function Detail_GetRevenue_ByType(n,t,i,r,u,f){return r==0?u==1?n==0?0:i/n:u==2?f==1?i:0:i:u==1?n==0?0:t/n:u==2?f==1?t:0:t}function Revenue_Executing_Tab_Detail(n,t,r,u,f,e){let o=u,h=0,c=0,l=0,a=0,s=0;for(i=0;i<o.length;i++){let u={};s=(o[i].EMP1!=0?1:0)+(o[i].EMP2!=0?1:0)+(o[i].EMP3!=0?1:0)+(o[i].EMP4!=0?1:0);h=o[i].EMP1!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,1);c=o[i].EMP2!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,0);l=o[i].EMP3!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,0);a=o[i].EMP4!=n?0:Detail_Executing_GetRevenue_Consult(s,o[i].Permision_Percent_Serivice,o[i].Permision_Amount_Serivice,o[i].Permision_Percent,o[i].Permision_Amount,o[i].Price,o[i].Quantity,o[i].TotalPay,e,0);u.Amount=h+c+l+a;u.ServiceID=o[i].ServiceID;u.Before_Revenue=0;u.Manual_Revenue=0;u.Date=o[i].Created;u.BranchID=o[i].BranchID;u.CustID=o[i].CustID;u.CustCode=o[i].CustCode;u.CustName=o[i].CustName;u.Type=t;r.push(u)}for(i=0;i<f.length;i++){let u={};h=f[i].EMP1==n?f[i].Commission1:0;c=f[i].EMP2==n?f[i].Commission2:0;l=f[i].EMP3==n?f[i].Commission3:0;u.Amount=h+c+l;u.ServiceID=f[i].ServiceID;u.Before_Revenue=0;u.Manual_Revenue=1;u.Date=f[i].Manual_Revenue_Date;u.BranchID=f[i].BranchID;u.CustID=f[i].CustID;u.CustCode=f[i].CustCode;u.CustName=f[i].CustName;u.Type=t;r.push(u)}}function Detail_Executing_GetRevenue_Consult(n,t,i,r,u,f,e,o,s,h){let a=0,v=0,c=0,l=0,y=0;return h==1&&r+u>0?(v=r,c=u,l=1):h==0&&r+u>0?l=-1:(v=t,c=i,l=0),l==-1?a=0:(y=c!=0?o/f*c*e:o/f*f*v/100,a=Detail_GetRevenue_ByType_Consult(n,y,s,h)),a}function Detail_GetRevenue_ByType_Consult(n,t,i,r){return i==1?n==0?0:t/n:i==2?r==1?t:0:t}function Revenue_Render_Data_Report(n,t,i){var u=document.getElementById(t),r;if(u!=null){u.innerHTML="";let e="",f=n;if(n&&n.length>0&&(i!=0&&(f=n.filter(n=>Number(n.Type)==i)),f&&f.length>0))for(r=0;r<f.length;r++){let n=f[r],t="<td>"+(r+1)+'<\/td><td><a href="/Customer/MainCustomer?CustomerID='+n.CustID+"&ver="+versionofWebApplication+'" target="_blank">'+n.CustCode+"<\/a><\/td><td>"+n.CustName+"<\/td><td>"+(Number(n.IsCard)==1?report_CardData[n.ServiceID]:report_ServiceData[n.ServiceID])+"<\/td><td>"+(report_BranchData[n.BranchID]!=undefined?report_BranchData[n.BranchID]:"")+"<\/td><td>"+formatDateToDMYHM(n.Date)+"<\/td><td>"+formatNumber(n.Amount)+'<\/td><td style="text-align:center">'+(n.Manual_Revenue?'<i class="imgGrid vtt-icon vttech-icon-check"><\/i>':"")+"<\/td>";e=e+'<tr role="row">'+t+"<\/tr>"}document.getElementById(t).innerHTML=e}}function Revenue_Load_Data_Indicator(n){if(n!=null&&n!=undefined){let t=n.filter(n=>Number(n.Type)==1).length,i=n.filter(n=>Number(n.Type)==2).length,r=n.filter(n=>Number(n.Type)==3).length,u=n.filter(n=>Number(n.Type)==4).length,f=u+t+i+r;Count_Up("revenue_amount_treat_doctor",Revenue_Total_Amount_By_Type(report_data,1));Count_Up("revenue_amount_treat",Revenue_Total_Amount_By_Type(report_data,2));Count_Up("revenue_amount_tech_support",Revenue_Total_Amount_By_Type(report_data,3));Count_Up("revenue_amount_consult",Revenue_Total_Amount_By_Type(report_data,4));Count_Up("revenue_amount_total",Revenue_Total_Amount_By_Type(report_data,0));Count_Up("revenue_amount_treat_doctor",t);Count_Up("revenue_value_time_treat",i);Count_Up("revenue_value_time_tech_support",r);Count_Up("revenue_value_time_consult",u);Count_Up("revenue_value_time_total",f)}}function Revenue_Total_Amount_By_Type(n,t){let i=0;if(n!=null&&n!=undefined){let r;if(r=t==0?n:n.filter(n=>Number(n.Type)==t),r&&r.length!=0)for(let n=0;n<r.length;n++)i+=Number(r[n].Amount)}return i}