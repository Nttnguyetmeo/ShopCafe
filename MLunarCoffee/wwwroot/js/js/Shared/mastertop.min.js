function MS_MainEvent(){$("#MS_NotiClear").click(function(){MS_NotiUpdateRead(-1,0);$(".ms_notiitem").remove();$("#MS_NotiContent hr").remove()});$("#MS_NotiReadAll").click(function(){MS_NotiUpdateRead(1,0);$(".ms_notiitem").removeClass("active")});$(document).on("mousedown",function(n){let t=$("#MS_SearchMainResult");$(t).is(n.target)||$(t).has(n.target).length!==0||$("#MS_SearchMainResult").hide();let i=$("#MS_NotiArea");$(i).is(n.target)||$(i).has(n.target).length!==0||$("#MS_NotiArea").hide();let r=$("#MS_PopupArea");$(r).is(n.target)||$(r).has(n.target).length!==0||$("#MS_PopupArea").hide()});$("#Master_Top .MS_DashboardDetail").click(function(){window.location.href="/Dash/Dash_Master?ver="+versionofWebApplication});$(".title-popup").popup({transition:"scale up",position:"right center"})}function MS_PopupUserShow(){let n=MS_GET_Position_Popup($("#MS_PopupArea").parent(),$("#MS_PopupArea"));$("#MS_PopupArea").css({display:"block",top:n.top+10,left:n.left-30,width:n.width!=undefined?n.width:""}).animate({top:n.top},300);event.stopPropagation()}function MS_PopupFillData(){$("#MS_PopupAvatar").attr({src:Master_circleAvatar,title:sys_userName_Main});$("#MS_PopupName").html(sys_userName_Main);$("#MS_PopupGroupName").html(Master_roleGroupCurrent);$("#MS_PopupEmpName").html(sys_employeeName_Main)}function MS_SearchText(n){try{return xoa_dau(n).replace(/[^a-zA-Z0-9 ]/g,"").toLowerCase()}catch(t){return""}}function MS_SearchExecute(n,t,i){seaching_ajax_request&&seaching_ajax_request.readyState!=4&&seaching_ajax_request.abort();t.length>=3?seaching_ajax_request=AjaxLoad(url="/Master/Master_Top/?handler=SearchQuick",data={textsign:n,textsearch:t,isInt:!isNaN(t)&&t.length<=10?1:0,IsSign:i},async=!0,error=function(){notiError_SW()},success=function(r){if(r!="0"){let e=1,f=JSON.parse(r),o=[],s=[],u=[];if(t=t.toLowerCase(),f!=undefined&&f.length!=0?(o=f.filter(n=>MS_SearchText(n.Name_NoSign).includes(t)||MS_SearchText(n.CustCodeOld).includes(t)||MS_SearchText(n.CustCode).includes(t)||MS_SearchText(n.City).includes(t)||MS_SearchText(n.District).includes(t)||MS_SearchText(n.Commune).includes(t)||MS_SearchText(n.DocumentCode).includes(t)||n.CustomerPhone.includes(t)||n.CustomerPhone2.includes(t)||n.MemberCode.includes(t)||n.TicketID!=0),s=f.filter(n=>!MS_SearchText(n.Name_NoSign).includes(t)&&!MS_SearchText(n.CustCodeOld).includes(t)&&!MS_SearchText(n.CustCode).includes(t)&&!MS_SearchText(n.City).includes(t)&&!MS_SearchText(n.District).includes(t)&&!MS_SearchText(n.Commune).includes(t)&&!MS_SearchText(n.DocumentCode).includes(t)&&!n.CustomerPhone.includes(t)&&!n.CustomerPhone2.includes(t)&&!n.MemberCode.includes(t)&&!n.TicketID!=0),u=o.concat(s),e=u!=undefined&&u.length!=0?1:0):e=0,e==1){i=="1"&&(u=u.sort(t=>{if(t.CustomerName.toLowerCase().includes(n))return-1}));MS_SearchRender(u,"MS_SearchResult");Count_Up("MS_CountResult",u.length);sys_Hightlight(t,"search_text_name");sys_Hightlight(t,"search_text_phone");sys_Hightlight(t,"search_text_code");sys_Hightlight(t,"search_text_address");sys_Hightlight(xoa_dau(n),"search_text_name");sys_Hightlight(xoa_dau(n),"search_text_phone");sys_Hightlight(xoa_dau(n),"search_text_code");sys_Hightlight(xoa_dau(n),"search_text_address");$("#MS_SearchMainResult").show();let r=$("#MS_SearchMainResult").parent().position().top;$("#MS_SearchMainResult").css({display:"block",top:r+20}).animate({top:r+40},300);Checking_TabControl_Permission()}else{$("#MS_SearchResult").empty();Count_Up("MS_CountResult",0);$("#MS_SearchMainResult").hide();$("#MS_SearchContent .btnsear_clear").removeClass("d-none");$("#MS_SearchMainResult").show();let n=$("#MS_SearchMainResult").parent().position().top;$("#MS_SearchMainResult").css({display:"block",top:n+20}).animate({top:n+40},300)}}},sender=null,before=null,complete=function(){$("#MS_SearchContent .spinner-border").hide();$("#MS_SearchContent .btnsear_clear").removeClass("d-none")}):($("#MS_SearchContent .spinner-border").hide(),$("#MS_SearchResult").empty(),Count_Up("MS_CountResult",0),$("#MS_SearchMainResult").hide(),$("#MS_SearchContent .btnsear_clear").removeClass("d-none"))}function MS_SearchRender(n,t){var r=document.getElementById(t),i;if(r!=null&&(r.innerHTML="",n&&n.length>0)){for(i=0;i<n.length;i++){let t=n[i],u=t.Gender==61?`<i class="me-1 text-sm fas fa-venus" style="color: rgb(255, 107, 133);"></i>`:`<i class="me-1 text-sm fas fa-mars" style="color: rgb(47, 137, 255);"></i>`,f=t.CustomerID!=0?"/Customer/MainCustomer?CustomerID="+t.CustomerID:"/Marketing/TicketAction?CustomerID=0&TicketID="+t.TicketID,e=`
                    <li class="border-0 p-0 list-group-item rounded-0 border-bottom-sm">
                        <a class="search_result d-block p-3" target="_blank" href="${f}&ver=${versionofWebApplication}">
                            <div class="d-flex flex-column justify-content-center ps-2">
                                <div class="text-md mb-0">
                                     ${u}
                                    <h1 class="search_text_name fw-bold text-sm text-dark pe-2  mb-0 d-inline">
                                        ${t.CustomerName}
                                    </h1>
                                    <p class="search_text_code mb-0 text-primary text-sm d-inline">
                                        <span>${t.CustCode!=""?t.CustCode:MS_SearchRender_GeneralCode(t.TicketID)}</span>
                                        ${t.DocumentCode!=""?`<span class="px-2">${t.DocumentCode}</span>`:``}
                                        ${t.MemberCode!=""?`<span class="px-2">${t.MemberCode}</span>`:``}
                              
                                        <span class="toogleitem" data-name="MS_CodeCusOld">${t.CustCodeOld!=""&&t.CustCodeOld!="0"?"["+t.CustCodeOld+"]":""}</span>
                                    </p>
                                </div>
                                <div class="text-sm text-dark mb-0">
                                    <i class="fas fa-mobile-alt text-xs"></i>
                                    ${t.CustomerPhone!=""?`<p class="search_text_phone _tab_control_ ps-2 text-sm mb-0 d-inline" data-staff="${t.StaffID}" data-tab="phone_customer" >${t.CustomerPhone}</p>`:``}
                                    ${t.CustomerPhone2!=""?`<p class="search_text_phone _tab_control_ ps-2 text-sm mb-0 d-inline" data-staff="${t.StaffID}" data-tab="phone_customer" >${t.CustomerPhone2}</p>`:``}
                                </div>
                                <div class="text-sm text-dark mb-0 toogleitem" data-name="MS_Birthday">
                                    <i class="fas fa-birthday-cake text-xs me-n1"></i>
                                    ${t.Birthday.includes("1900")?``:`<p class="search_text_phone _tab_control_ ps-2 d-inline text-sm mb-0">${ConvertDateTimeToString_D_M_Y(t.Birthday)}</p>`}
                                </div>
                                <div class="text-sm text-dark mb-0 toogleitem" data-name="MS_Address">
                                    <span class="mb-0 fw-bold">${Outlang.Sys_dia_chi??`Địa chỉ`}:</span>
                                    <p class="ps-1 d-inline text-sm mb-0 search_text_address">
                                        ${t.City!=""?t.City+`,`:``}
                                        ${t.District!=""?t.District+`,`:``}
                                        ${t.Commune!=""?t.Commune:``}
                                    </p>
                                </div>
                            </div>
                        </a>
                    </li>
                `;r.insertAdjacentHTML("beforeend",e)}MS_ShTable.Refresh()}}function MS_SearchRender_GeneralCode(n){try{let t="00000000";t=t+n.toString();let i=t.length;return t.slice(i-8,i)}catch(t){return""}}function MS_NotiLoad(){AjaxLoad(url="/Master/Master_Top/?handler=NotiItemCount",data={},async=!0,error=function(){notiError_SW()},success=function(n){if(n!="0"){let t=JSON.parse(n),i=t[0].Number_UnRead;Number(i)!=0?($("#MS_NotiTotal").removeClass("d-none"),$("#MS_NotiTotal").html(t[0].Number_UnRead)):$("#MS_NotiTotal").addClass("d-none")}else $("#MS_NotiTotal").addClass("d-none")},sender=null)}function MS_NotiUpdateRead(n,t,i){AjaxLoad(url="/Master/Master_Top/?handler=NotiExecute",data={IsReadAll:n,NotiID:t,todo:i!=undefined?i:0},async=!0,error=function(){notiError_SW()},success=function(n){n=="1"&&MS_NotiLoad()},sender=null)}function MS_NotiEvent(){$(".ms_notiitem").click(function(){let n=$(this).attr("data-id"),t=$(this).attr("data-todo");$(this).removeClass("active");MS_NotiUpdateRead(0,n,t)})}function MS_NotiShow(){let n=MS_GET_Position_Popup($("#MS_NotiArea").parent(),$("#MS_NotiArea"));$("#MS_NotiArea").css({display:"block",top:n.top+10,left:n.left,width:n.width!=undefined?n.width:""}).animate({top:n.top},300);AjaxLoad(url="/Master/Master_Top/?handler=NotiItemLoad",data={},async=!0,error=function(){notiError_SW()},success=function(n){if(n!="0"){let t=JSON.parse(n);MS_NotiRender(t,"MS_NotiContent");$("#MS_NotiEmpty").hide();$("#MS_NotiClear").show();$("#MS_NotiReadAll").show()}else $("#MS_NotiArea_action").hide(),$("#MS_NotiEmpty").show(),$("#MS_NotiClear").hide(),$("#MS_NotiReadAll").hide()},sender=null,before=function(){$("#MS_NotiContent").empty();$("#MS_NotiContent").hide();$("#MS_NotiWaiting").show()},complete=function(){$("#MS_NotiContent").show();$("#MS_NotiWaiting").hide()});event.stopPropagation()}function MS_NotiRender_GetLInk(n,t,i,r,u){let f="";if(n==0)switch(t){case 1:case 2:case 4:case 5:case 9:f=i+"?ver="+versionofWebApplication;f='<a href="'+f+'" target="_blank" class="detail ps-2 fw-bold text-dark opacity-2">'+Outlang.Chi_tiet+"<\/a>";break;case 3:f=i+r+"&ver="+versionofWebApplication;f='<a href="'+f+'" target="_blank" class="detail ps-2 fw-bold text-dark opacity-2">'+Outlang.Chi_tiet+"<\/a>";break;case 6:f=i+u+"&CustomerID="+r+"&ver="+versionofWebApplication;f='<a href="'+f+'" target="_blank" class="detail ps-2 fw-bold text-dark opacity-2">'+Outlang.Chi_tiet+"<\/a>";break;case 7:f=i+"?ver="+versionofWebApplication;f='<a href="'+f+'" target="_blank" class="detail ps-2 fw-bold text-dark opacity-2">'+Outlang.Chi_tiet+"<\/a>";break;case 8:f=i+"?ver="+versionofWebApplication;f='<a href="'+f+'" target="_blank" class="detail ps-2 fw-bold text-dark opacity-2">'+Outlang.Chi_tiet+"<\/a>"}else f="";return f}function MS_NotiRender_GetAction(n,t){let i="";if(n==0)switch(t){case 1:case 2:i='<span class="badge badge-sm badge-circle badge-floating bg-gradient-info position-absolute border-white" style="bottom: -3px;right: -4px;border: 2px solid white;"><i class="vtt-icon vttech-icon-list-ticket-file text-white" style="font-size: 10px;"><\/i><\/span>';break;case 3:i='<span class="badge badge-sm badge-circle badge-floating bg-gradient-success position-absolute border-white" style="bottom: -3px;right: -4px;border: 2px solid white;"><i class="fas fa-chevron-right text-white" style="font-size: 10px;"><\/i><\/span>'}else i='<span class="badge badge-sm badge-circle badge-floating bg-gradient-success position-absolute border-white" style="bottom: -3px;right: -4px;border: 2px solid white;"><i class="vtt-icon vttech-icon-task  text-white" style="font-size: 10px;"><\/i><\/span>';return i}function MS_NotiRender(n,t){var i=document.getElementById(t);if(i!=null){i.innerHTML="";let r="";if(n&&n.length>0)for(let t=0;t<n.length;t++){let i=n[t],s=Number(i.IsRead)==1?"":"active",e="",u="",o="",h=Number(i.IsRead)==1?"":'<span class="unread badge badge-md badge-dot me-2 ms-auto opacity-0"><i class="bg-gradient-primary"><\/i><\/span>';o=MS_NotiRender_GetAction(i.IsTodo,i.Type);let f=Fun_GetObject_ByID(MTDataEmployee,i.UserSend);f!=null?(u=f.Avatar,e=f.Name):(u=Master_Default_Pic,e="");let c=GetTimeAgo_FromCurrent(i.DateNoti),l=MS_NotiRender_GetLInk(i.IsTodo,i.Type,i.Link,i.CustomerID,i.TicketID);r=r+'<li class="ms_notiitem list-group-item border-0 d-flex align-items-center mb-2 p-2 rounded-3 '+s+'" data-id="'+i.ID+'" " data-todo="'+i.IsTodo+'"><div class="w-30 avatar avatar-sm me-3  position-relative"><img src="'+u+'"  class="border-radius-lg shadow">'+o+'<\/div><div class="w-70 d-flex align-items-start flex-column justify-content-center"><span class="text-dark mb-0 text-sm fw-bold ellipsis_one_line">'+i.ContentNoti+'<\/span><p class="text-dark mb-0 text-xs">'+c+l+"<\/p><\/div>"+h+'<\/li><hr class="horizontal dark mt-0 mb-0">'}document.getElementById(t).innerHTML=r;MS_NotiEvent()}}function MS_SearchEnterExecute(){let t=location.pathname.split("/").slice(-1)[0],n=xoa_dau($("#MS_SearchInput").val().toLowerCase()).trim();t=="Searching"?window.open("/Searching/Searching?SeachingText="+n,"_self"):window.open("/Searching/Searching?SeachingText="+n)}function MS_GET_Position_Popup(n,t){let i={top:0,left:0},f=$(window).width(),s=n.outerHeight(),e=n.outerWidth(),h=t.outerHeight(),r=t.outerWidth(),o=n.offset(),c=o.top,u=o.left;return f-u>r?i.left=0:u-r+e>0?i.left=-r+e:(i.left=-u+10,i.width=f-20),i.top=s,i}var mainbody;$("#MS_SearchInput").keyup(function(){$(this).val().length>0?$("#MS_SearchContent .btnsear_clear").removeClass("opacity-1").addClass("d-none"):$("#MS_SearchContent .btnsear_clear").addClass("opacity-1").addClass("d-none");$("#MS_SearchContent .spinner-border").show();clearTimeout(Timer_Search_Customer);Timer_Search_Customer=setTimeout(function(){let n=$("#MS_SearchInput").val().toLowerCase().trim(),t=xoa_dau(n).replace(/[^a-zA-Z0-9 ]/g,""),i=n==t?0:1;MS_SearchExecute(n,t,i)},500);setTimeout(function(){$("#MS_SearchContent .spinner-border").hide()},1e3)});$("#MS_SearchInput").focus(function(){clearTimeout(Timer_Search_Customer);Timer_Search_Customer=setTimeout(function(){let n=$("#MS_SearchInput").val().toLowerCase().trim(),t=xoa_dau(n).replace(/[^a-zA-Z0-9 ]/g,""),i=0;CheckIsSeachLastName(n)&&(i=1,t=getLastName(n));MS_SearchExecute(n,t,i)},500)});$("#MS_SearchContent").on("click",".btnsear_clear",function(){$("#MS_SearchInput").val("");$("#MS_SearchContent .btnsear_clear").addClass("opacity-1");$("#MS_SearchResult").empty();Count_Up("MS_CountResult",0);$("#MS_SearchMainResult").hide();$("#MS_SearchContent .spinner-border").hide()});if(document.querySelector(".fixed-plugin")){let n=document.querySelector(".fixed-plugin"),i=document.querySelector(".fixed-plugin-button"),t=document.querySelectorAll(".fixed-plugin-button-nav"),u=document.querySelectorAll(".fixed-plugin-close-button"),f=document.querySelector(".fixed-plugin .card"),r=document.getElementById("navbarBlur"),e=document.getElementById("navbarFixed");i&&(i.onclick=function(){n.classList.contains("show")?n.classList.remove("show"):n.classList.add("show")});t&&t.forEach(t=>{t.onclick=function(){n.classList.contains("show")?n.classList.remove("show"):n.classList.add("show")}});u.forEach(function(t){t.onclick=function(){n.classList.remove("show")}});document.querySelector("body").onclick=function(r){r.target!=i&&r.target!=t[0]&&r.target!=t[1]&&r.target.closest(".fixed-plugin .card")!=f&&n.classList.remove("show")};r&&r.getAttribute("data-scroll")=="true"&&e}if(document.querySelector(".sidenav-toggler")){var sidenavToggler=document.querySelectorAll(".sidenav-toggler"),sidenavShow=document.getElementsByClassName("g-sidenav-show")[0],toggleNavbarMinimize=document.getElementById("navbarMinimize");sidenavShow&&sidenavToggler.forEach(n=>{n.onclick=function(){sidenavShow.classList.contains("g-sidenav-hidden")?(sidenavShow.classList.remove("g-sidenav-hidden"),sidenavShow.classList.add("g-sidenav-pinned"),toggleNavbarMinimize&&(toggleNavbarMinimize.click(),toggleNavbarMinimize.removeAttribute("checked"))):(sidenavShow.classList.remove("g-sidenav-pinned"),sidenavShow.classList.add("g-sidenav-hidden"),toggleNavbarMinimize&&(toggleNavbarMinimize.click(),toggleNavbarMinimize.setAttribute("checked","true")))}});window.innerWidth<1200&&(mainbody=document.getElementById("BodyMain"),mainbody&&mainbody.classList.add("g-sidenav-hidden"))}