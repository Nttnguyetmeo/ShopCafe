function CCF_CallFail(){Incommingaudio!=undefined&&Incommingaudio!=null&&(Incommingaudio.pause(),Incommingaudio.currentTime=0);$("#CallCenter_Area").addClass("d-none");CCF_ResetFiled();flagCalling=0}function CCF_BeginTime(){CC_TotalSeconds=0}function CCF_setTime(){++CC_TotalSeconds;$("#CallCenter_ProgressingTime").html(CCF_pad(parseInt(CC_TotalSeconds/60))+":"+CCF_pad(CC_TotalSeconds%60))}function CCF_pad(n){let t=n+"";return t.length<2?"0"+t:t}function CCF_Event(){$("#CallCenter_ProgressingMute").on("click",function(){$("#CallCenter_ProgressingUnMute").removeClass("d-none");$(this).addClass("d-none");CallingMute()});$("#CallCenter_ProgressingUnMute").on("click",function(){$("#CallCenter_ProgressingMute").removeClass("d-none");$(this).addClass("d-none");CallingUnMute()});$("#CallCenter_ProgressingEndCall").on("click",function(){sip_hangup();$("#CallCenter_Area").addClass("d-none");CCF_ResetFiled()})}function CCF_ResetFiled(){CC_TotalSeconds=0;clearInterval(interval);interval=null;$("#CallCenter_HangDiv").removeClass("d-none");$("#CallCenter_ProgressingArea").addClass("d-none");$("#CallCenter_ProgressingMute").removeClass("d-none");$("#CallCenter_ProgressingUnMute").addClass("d-none");$("#CallCenter_Name").html(Outlang.Khong_co_ho_so);$("#CallCenter_Phone").html("");$("#CallCenter_ProgressingTime").html("");$("#CallCenter_Avatar").attr("src","/assests/img/gray.png");$("#CallCenter_MultiPhone").html("")}function sip_incomingcall(n,t){if(flagCalling==0)try{CCF_ResetFiled();$("#CallCenter_Area").removeClass("d-none");Incommingaudio.loop=!0;Incommingaudio.play();CCF_Incom_DetectPhone(n,t)}catch(i){CCF_Incom_DetectPhone(n,t)}}function CCF_Incom_DetectPhone(n,t){let i="",r="",u="/assests/img/gray.png";if($("#CallCenter_Avatar").attr("src",u),$("#CallCenter_Header").html(Outlang.Cuoc_goi_den||"Cuộc gọi đến"),t!="0")t.indexOf(":")>0&&(t=t.split(":")[0]??t),i=t;else{let t=n.split(":"),r=t[1].split("@");i=r[0]}AjaxJWT(url="/api/Call/InCommingCall",data=JSON.stringify({phone:i}),async=!0,success=function(n){if(n!="0"){let t=JSON.parse(n);r=t[0].Name;let f=t[0].CustID,e=t[0].Code;f!=""?$("#CallCenter_Name").html('<a target="_blank" class="text-white" href="/Customer/MainCustomer?CustomerID='+f+'">'+e+" - "+r+"<\/a>"):$("#CallCenter_Name").html(r);$("#CallCenter_Phone").html(i);$("#CallCenter_Avatar").attr("src",t[0].Image?t[0].Image:u)}else $("#CallCenter_Name").html(Outlang.Khong_co_ho_so),$("#CallCenter_Phone").html(i),$("#CallCenter_Avatar").attr("src",u)})}function CCF_Incom_Accept(){try{return Incommingaudio.pause(),Incommingaudio.currentTime=0,$("#CallCenter_HangDiv").addClass("d-none"),$("#CallCenter_ProgressingArea").removeClass("d-none"),CCF_Event(),CallingAnswer(),flagCalling=1,!1}catch(n){return flagCalling=0,!1}}function CCF_Incom_Decline(){return Incommingaudio!=undefined&&Incommingaudio!=null&&(Incommingaudio.pause(),Incommingaudio.currentTime=0),sip_hangup(),$("#CallCenter_Area").addClass("d-none"),CCF_ResetFiled(),flagCalling=0,!1}function CCF_OutcomCall(n,t,i,r){if(CCF_ResetFiled(),CCOutsite_Line!=""&&CCOutsite_Link!="")AjaxJWT(url="/api/Call/DetectPhone",data=JSON.stringify({cus:t,tic:0,line:0,linefromcall:CCOutsite_Line,linkfromcall:CCOutsite_Link}),async=!0,success=function(n){n==="-1"?notiWarning(Outlang.Khong_ton_tai):n==="0"||CCF_Call_Outsize(linkClickToCall,callextension,callApi_Key,calldomainApi,n,r)});else return $("#CallCenter_HangDiv").addClass("d-none"),$("#CallCenter_Header").html(Outlang.Cuoc_goi_di),Incommingaudio.pause(),Incommingaudio.currentTime=0,AjaxJWT(url="/api/Call/OutCommingCall",data=JSON.stringify({cus:t,tic:i,line:r}),async=!0,success=function(n){let u=JSON.parse(n),t=u.Table,f=u.Table1,i=f[0].Phone1,e=f[0].Phone2;t!=null&&t.length!=0?($("#CallCenter_Name").html(t[0].ID!="0"?'<a target="_blank" class="text-white" href="/Customer/MainCustomer?CustomerID='+t[0].ID+'">'+t[0].Code+" - "+t[0].Name+"<\/a>":t[0].Name),$("#CallCenter_Avatar").attr("src",t[0].Image!=""?t[0].Image:Master_Default_Pic)):($("#CallCenter_Name").html(Outlang.Khong_co_ho_so),$("#CallCenter_Avatar").attr("src",Master_Default_Pic));i!=""&&e!=""?CCF_Outcom2Phone(i,e):(r!=0?(sip_callexe(r,function(n){syslog_call("i",n)}),$("#CallCenter_Phone").html(r)):(sip_callexe(i,function(n){syslog_call("i",n)}),$("#CallCenter_Phone").html(i)),$("#CallCenter_ProgressingArea").removeClass("d-none"));Checking_TabControl_Permission()}),$("#CallCenter_Area").removeClass("d-none"),CCF_Event(),!1}async function CCF_Call_Outsize(n,t,i,r,u){new Promise(()=>{let f=`${n}/from_number/${t}/to_number/${u}/key/${i}/domain/${r}`;$.get(f,function(n){n!="Success"&&notiWarning("Error")})})}function CCF_OutcomCallPhone(n){if(n.length>=3)return $("#CallCenter_HangDiv").addClass("d-none"),$("#CallCenter_Header").html(Outlang.Cuoc_goi_di),Incommingaudio.pause(),Incommingaudio.currentTime=0,AjaxJWT(url="/api/Call/InCommingCall",data=JSON.stringify({phone:n}),async=!0,success=function(t){if(t!="0"){let n=JSON.parse(t),i=n[0].Name,r=n[0].CustID,u=n[0].Code;r!=""?$("#CallCenter_Name").html('<a target="_blank" class="text-white" href="/Customer/MainCustomer?CustomerID='+r+'">'+u+" - "+i+"<\/a>"):$("#CallCenter_Name").html(i);$("#CallCenter_Avatar").attr("src",n[0].Image!=""?n[0].Image:Master_Default_Pic)}else $("#CallCenter_Name").html(Outlang.Khong_co_ho_so),$("#CallCenter_Avatar").attr("src",Master_Default_Pic);sip_callexe(n,function(n){syslog_call("i",n)});$("#CallCenter_ProgressingArea").removeClass("d-none");$("#CallCenter_Phone").html(n);Checking_TabControl_Permission()}),$("#CallCenter_Area").removeClass("d-none"),CCF_Event(),!1}function CCF_Outcom2Phone(n,t){let i=n.length>0?encrypt_phone(n.replace(" ","")):"",r=t.length>0?encrypt_phone(t.replace(" ","")):"",u=`
        <span>${Outlang.Chon_sdt}</span>
        <div class="d-flex mt-2">
            <span data-info="${i}" data-tab="phone_customer" class="_tab_control_ call w-50 text-dark text-sm me-3 badge bg-gradient-light cursor-pointer my-1">
                ${n}
            </span>
            <span data-info="${r}" data-tab="phone_customer" class="_tab_control_ call w-50 text-dark text-sm badge bg-gradient-light cursor-pointer my-1">
                ${t}
            </span>
        </div>`;$("#CallCenter_MultiPhone").html(u);$("#CallCenter_MultiPhone .call").on("click",function(){let n=$(this).attr("data-info");return $("#CallCenter_Phone").html($(this).html()),$("#CallCenter_MultiPhone").html(""),$("#CallCenter_ProgressingArea").removeClass("d-none"),sip_callexe(decrypt_phone(n),function(n){syslog_call("i",n)}),!1})}var CC_TotalSeconds=0;