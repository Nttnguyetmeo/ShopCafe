function AD_OnBranchEvent(){typeof App_Detail_Flag!="undefined"&&App_Detail_Flag==1&&AD_LoadInfo();typeof App_Detail_Flag!="undefined"&&App_Detail_Flag==1&&$("#app_detail_ex_timeline").length!=0&&AD_TimeLineLoad()}function AD_OnDoctorEvent(){typeof App_Detail_Flag!="undefined"&&App_Detail_Flag==1&&$("#app_detail_ex_timeline").length!=0&&AD_TimeLineLoad()}function AD_OnTimeEvent(){typeof App_Detail_Flag!="undefined"&&App_Detail_Flag==1&&$("#app_detail_ex_timeline").length!=0&&AD_TimeLineDetect()}function AD_OnDateFormEvent(){clearTimeout(Timer_Change_Appointment);Timer_Change_Appointment=setTimeout(function(){typeof App_Detail_Flag!="undefined"&&App_Detail_Flag==1&&AD_LoadInfo();typeof App_Detail_Flag!="undefined"&&App_Detail_Flag==1&&$("#app_detail_ex_timeline").length!=0&&AD_TimeLineLoad()},500)}function AD_LoadInfo(){let n=$("#App_Detail_Date_From").val()+" "+$("#App_Detail_DateFrom_Time").val(),t=Number($("#App_Detail_Branch_ID").dropdown("get value"))?Number($("#App_Detail_Branch_ID").dropdown("get value")):0;AjaxLoad(url="/Appointment/AppointmentDetail/?handler=GetInfoAppointment",data={CustomerID:ser_CustomerAppointmentID,BranchID:t,Date:n,CurrentAppID:ser_CurrentAppointmentID},async=!0,error=function(){notiError_SW()},success=function(n){if(n!=""){let t=JSON.parse(n),i=t.Table,r=t.Table1;AD_RenderInfo(i,r)}},sender=null)}function AD_RenderInfo(n,t){n&&n.length>0&&($("#app_total_morning").html(n[0].TotalApp_M),$("#app_total_afternoon").html(n[0].TotalApp_A));t&&t.length>0?$("#app_customer_next").html(t[0].Date_From):$("#app_customer_next").html("-")}function AD_OnTypeEvent(n){$("#AppDetail_TypeArea .appde_text").removeClass("active");$("#AppDetail_TypeArea .appde_text[data-id="+n+"]").addClass("active");n==1?($(".cbbApp_Detail_ServiceCare").show(),$(".ccbApp_Detail_ServiceTreatment").hide(),$("#App_Detail_ServiceTreatmentToken").dropdown("clear"),document.getElementById("App_Detail_Consult_ID").classList.remove("disabled")):($(".cbbApp_Detail_ServiceCare").hide(),$(".ccbApp_Detail_ServiceTreatment").show(),$("#App_Detail_ServiceCareToken").dropdown("clear"),$("#App_Detail_Consult_ID").dropdown("clear"),document.getElementById("App_Detail_Consult_ID").classList.add("disabled"))}function AD_TimeLineDetect(){if($("#Doctor_Scheduler_Ext_Current").length){let r=$("#Doctor_Scheduler_Ext_Current")[0],n={};n._id=r.attributes.id.nodeValue;let t=$("#App_Detail_Date_From").val()+" "+$("#App_Detail_DateFrom_Time").val(),u=GetDateTime_Now_Only_Date(),f=Number($("#App_Detail_TimeSchedule").dropdown("get value")),i=Math.ceil((ConvertString_DMY_To_DateTime(t)-u)/864e5),e=ConvertString_DMYHM_To_DateTime(t).addDays(-i),o=ConvertString_DMYHM_To_DateTime(t).addDays(-i).addMinutes(f);n.start=ConvertDateTime_To_Timespan_TimeZone(e);n.stop=ConvertDateTime_To_Timespan_TimeZone(o);AD_TimeLineEdit(n)}else{let n={};n._id="Doctor_Scheduler_Ext_Current";let t=$("#App_Detail_Date_From").val()+" "+$("#App_Detail_DateFrom_Time").val(),r=GetDateTime_Now_Only_Date(),u=Number($("#App_Detail_TimeSchedule").dropdown("get value")),i=Math.ceil((ConvertString_DMY_To_DateTime(t)-r)/864e5),f=ConvertString_DMYHM_To_DateTime(t).addDays(-i),e=ConvertString_DMYHM_To_DateTime(t).addDays(-i).addMinutes(u);n.start=ConvertDateTime_To_Timespan_TimeZone(f);n.stop=ConvertDateTime_To_Timespan_TimeZone(e);AD_TimeLineAdd(n)}}function AD_SaveChecking(n){AjaxLoad(url="/Appointment/AppointmentDetail/?handler=CheckDataDetail",data={BranchID:n.branch_ID,CustomerID:ser_CustomerAppointmentID,DateFrom:n.Date_from,CurrentAppID:ser_CurrentAppointmentID},async=!1,error=function(){notiError_SW()},success=function(t){let i=JSON.parse(t);if(i[0].result=="1")AD_SaveExecuted(n);else{let u=i[0].result,t=i[0].id;ser_NearAppointmentID=i[0].id;let r=n.Date_from;switch(u){case"AppInDay":AD_DuplicateShow(t,"AppInDay",r);break;case"AppNear":ser_CurrentAppointmentID=="0"?AD_DuplicateShow(t,"AppNear",r):AD_SaveExecuted(n)}}},sender=null)}function AD_SaveExecutedLoad(){typeof IsPageGeneral=="function"&&IsPageGeneral==1&&location.reload();typeof LoadCustomerCareAjax=="function"&&(notiSuccess(),LoadCustomerCareAjax());typeof TicketAction_SchedulerLoad=="function"&&TicketAction_SchedulerLoad();typeof GeneralInfo_LoadApp=="function"&&GeneralInfo_LoadApp();typeof LoadTickedValueAjax=="function"&&(notiSuccess(),LoadTickedValueAjax());typeof LoadScheduleAjax=="function"&&(notiSuccess(),LoadScheduleAjax());typeof SSO_handleNextSchedule=="function"&&(notiSuccess(),SSO_handleNextSchedule(ser_CustomerAppointmentID));typeof DAHD_CallBackAfterHandle=="function"?DAHD_CallBackAfterHandle(ser_AC_AppointmentID):typeof Treatment_List_Service_Load=="function"?(notiSuccess(),Treatment_List_Service_Load()):typeof callvtt_branchload=="function"||(typeof TicketAction_LoadInfo=="function"?TicketAction_LoadInfo():typeof GeneralInfo_LoadApp=="function"?GeneralInfo_LoadApp():location.reload());typeof LoadCustomerScheduleNext=="function"&&LoadCustomerScheduleNext();typeof AD_CloseModal=="function"?AD_CloseModal():CloseModal()}function AD_DuplicateBack(){$("#appointmentDetail").removeClass("appdetail_disable");$("#appointmentDuplicate").addClass("d-none");$("#AD_DuplicateArea").addClass("opacity-0")}function AD_DuplicateSave(){AD_DuplicateBack();AD_SaveAction(2)}function AD_DuplicateShow(n,t,i){return i=i.split(" ")[0],AjaxLoad(url="/Appointment/AppointmentDetail/?handler=Duplicate",data={AppID:n},async=!0,error=function(){notiError_SW()},success=function(n){if(n!=""){let u=JSON.parse(n),i=u.DataApp,r="";t=="AppInDay"&&(r="Duplicate",$("#AD_DuplicateHeader").removeClass("text-dark"),$("#AD_DuplicateHeader").addClass("text-danger"),$("#AD_DuplicateReject").removeClass("d-none"),$("#AD_DuplicateSaveBtn").addClass("d-none"),$("#AD_DuplicateNotice").addClass("d-none"));t=="AppNear"&&(r="Notice",$("#AD_DuplicateHeader").addClass("text-dark"),$("#AD_DuplicateHeader").removeClass("text-danger"),$("#AD_DuplicateReject").addClass("d-none"),$("#AD_DuplicateSaveBtn").removeClass("d-none"),$("#AD_DuplicateNotice").removeClass("d-none"));$("#AD_DuplicateHeader").html(r);$("#AD_DuplicateHour").html(i[0].HourApp);$("#AD_DuplicateDate").html(i[0].DateApp+" "+i[0].HourApp);$("#AD_DuplicateBranch").html(i[0].BranchName);$("#AD_DuplicateCreated").html(i[0].UserCreated);$("#appointmentDetail").addClass("appdetail_disable");$("#appointmentDuplicate").removeClass("d-none");$("#AD_DuplicateArea").removeClass("opacity-0")}},sender=null),!1}function AD_RetreatShow(n){return $("#DetailModal_Content").html(""),$("#DetailModal_Content").load("/Appointment/AppointmentReTreatUpdate?CustomerID="+n+"&ver="+versionofWebApplication),$("#DetailModal").modal("show"),!1}