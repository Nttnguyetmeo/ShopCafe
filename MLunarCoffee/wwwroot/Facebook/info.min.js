async function PInfo_LoadInfo(){return new Promise(()=>{AjaxLoad(url="/Facebook/Chating/Profileinfo/?handler=LoadInfo",data={PID:fb_pageid,PSID:fb_userid},async=!0,error=null,success=function(n){if(n!="0"){PI_Flag=1;let t=JSON.parse(n);if(t&&t.length>0){let n=t[0].CusID;if(n!=0?($("#PI_Created").html(t[0].Created.includes("1900")?"-":ConvertDateTimeToString_D_M_Y(t[0].Created)),$("#PI_CreatedBy").html(t[0].CreateBy!=""?t[0].CreateBy:"-"),$("#PI_CusCode").html(t[0].CusCode!=""?t[0].CusCode:"-"),$("#PI_CusCode").attr("target","_blank"),$("#PI_CusCode").attr("href","/Customer/MainCustomer?CustomerID="+t[0].CusID+"&ver="+versionofWebApplication),$("#PI_cusarea").removeClass("d-none"),$("#PI_cusnoarea").addClass("d-none")):PInfo_ClearCusIn(),PInfo_ClearEmp(),t[0].AssignID!=0){let n=PI_DTUser.filter(n=>n.ID==t[0].AssignID);n&&n.length==1?$("#PI_UserID").dropdown("set selected",n[0].ID):($("#PI_UserID").addClass("disabled"),$("#PI_UserID").dropdown("set text",t[0].AssignName))}}else PInfo_ClearEmp(),PInfo_ClearCusIn();PI_Flag=0}},sender=null,before=function(){$("#PI_cusnoarea").addClass("d-none");$("#PI_cusarea").addClass("d-none")},complete=function(){})})}function PInfo_ClearEmp(){$("#PI_UserID").dropdown("clear");$("#PI_UserID").removeClass("disabled")}function PInfo_ClearCusIn(){$("#PI_Created").html("-");$("#PI_CreatedBy").html("-");$("#PI_CusCode").html("-");$("#PI_CusCode").removeAttr("target");$("#PI_CusCode").removeAttr("href");$("#PI_cusarea").addClass("d-none");$("#PI_cusnoarea").removeClass("d-none")}function PInfo_ExecutedAssign(n){AjaxLoad(url="/Facebook/Chating/Profileinfo/?handler=ExecutedAssign",data={PID:fb_pageid,PSID:fb_userid,AssignID:n},async=!0,error=null,success=function(n){n=="0"&&notiError_SW()})}async function PInfo_RenderTag(n,t){new Promise(i=>{var r=document.getElementById(t),f,u;if(r!=null)for([f,u]of Object.entries(n)){let n=u,t=`
                            <div class="row my-1">
                                <div class="form-check w-auto  d-flex align-items-center">
                                    <input id="pntag_${n.ID}" class="form-check-input ftag pr-2 btnTag" data-id="${n.ID}" type="checkbox">
                                    <div class="text-sm px-3 mt-1 py-1 ms-2 rounded-2" style="background: ${n.Color}2b; color: ${n.Color};">${n.Name}</div>
                                </div>
                            </div>
                        `;r.insertAdjacentHTML("beforeend",t)}PInfo_EventTag();i()})}async function PInfo_FillTag(n){return new Promise(t=>{PI_Flag=1;let i=n.split("t");$(".btnTag").prop("checked",!1);for(let n=0;n<i.length;n++)i[n]!=""&&$(".btnTag[data-id='"+i[n]+"']").prop("checked",!0);PI_Flag=0;t()})}function PInfo_EventTag(){$("#fbp_tag .btnTag").unbind("click").on("click",function(){if(PI_Flag==0){let n=document.getElementsByClassName("btnTag");if(fb_currentag="",n&&n.length>0)for(let t=0;t<n.length;t++){let i=n[t],r=$(i).attr("data-id");$(i).prop("checked")&&(fb_currentag=fb_currentag+r+"t")}if(fb_currentag.length>=0){fb_currentag.charAt(0)!="t"&&(fb_currentag="t"+fb_currentag);let n=fb_currentag.split("t"),t=0;for(let i=0;i<n.length;i++)if(n[i]!=""){t=Number(n[i]);break}fb_currentag=="t"&&(fb_currentag="");PInfo_ExecutedTag(t,fb_currentag,succfun=function(n){PInfo_UpdateCon(fbm_conid,n)})}}})}async function PInfo_ExecutedTag(n,t,i){return new Promise(r=>{AjaxJWT(url="/api/FacebookBridge/UpdateTag",data=JSON.stringify({converid:fbm_conid,keypage:fb_pageid,tagid:n,tag:t}),async=!0,success=function(){i(t)}),r()})}async function PInfo_UpdateCon(n,t){return new Promise(i=>{$("#con"+n).attr("data-tag",t),FBC_TagRender(n,t),i()})}