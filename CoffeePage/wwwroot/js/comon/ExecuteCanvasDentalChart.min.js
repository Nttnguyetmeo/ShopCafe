function _Add_Disease_(n,t,i,r,u,f,e){let o=!1;for(ii=0;ii<CurrentDisease.length;ii++)CurrentDisease[ii].type==t&&CurrentDisease[ii].teethid==i&&CurrentDisease[ii].diseaseid==n&&CurrentDisease[ii].typecircle==r&&(CurrentDisease[ii].diseaseid=n,CurrentDisease[ii].diseasename=data_disease.filter(t=>t.ID==n)[0].Name,CurrentDisease[ii].empid=sys_employeeID_Main,CurrentDisease[ii].empname=sys_employeeName_Main,CurrentDisease[ii].userid=sys_userID_Main,CurrentDisease[ii].date=GetDateTime_Now_To_String(),CurrentDisease[ii].updatetime=GetDateTime_Now_To_String(),o=!0,ii=CurrentDisease.length);if(!o){let o={};o.detailid=0;o.diseaseid=n;o.diseasename=data_disease.filter(t=>t.ID==n)[0].Name;o.type=t;o.teethid=i;o.typecircle=r;o.pathcircle=u;o.face=f;o.root=e;o.userid=sys_userID_Main;o.empid=sys_employeeID_Main;o.empname=sys_employeeName_Main;o.date=GetDateTime_Now_To_String();o.updatetime=GetDateTime_Now_To_String();o.note="";o.proposed_treat="";o.classification=0;o.DeleteButton=1;CurrentDisease.push(o)}}function _Draw_Disease_Design_TEETH_WHOLE(){for(k=0;k<CurrentDisease.length;k++)if(Number(CurrentDisease[k].type)==2){let n=data_layout_path.filter(n=>n.ID==CurrentDisease[k].pathcircle)[0];if(n!=undefined){let t=n.pathData,i=JSON.parse(data_disease.filter(n=>n.ID==CurrentDisease[k].diseaseid)[0].Data).data[0].data;Particular_Draw_CIRCLE(CurrentDisease[k].teethid,CurrentDisease[k].typecircle,t,i)}}else{let t=data_disease.filter(n=>n.ID==CurrentDisease[k].diseaseid),n=t!=undefined&&t.length!=0?JSON.parse(t[0].Data).data:[];for(let t=0;t<n.length;t++)switch(n[t].area){case"l":case"t":case"r":case"b":case"c":let r="teeth_circle_"+n[t].area+"_"+CurrentDisease[k].teethid,u=document.getElementById(r).attributes.data_path.value,i=data_layout_path.filter(n=>n.ID==u)[0];if(i!=undefined){let r=i.pathData;Particular_Draw_CIRCLE(CurrentDisease[k].teethid,n[t].area,r,n[t].data)}break;case"rootface":Particular_Draw_FACEROOT(CurrentDisease[k].teethid,n[t].data,CurrentDisease[k].root,CurrentDisease[k].face)}}}function Particular_GetPath_Image(n,t){let r=data_layout_image_disease.filter(t=>t.ID==n)[0],i="";switch(t){case"Root_1_U":i=r.Root_1_U;break;case"Root_3_U":i=r.Root_3_U;break;case"Root_1_D":i=r.Root_1_D;break;case"Root_3_D":i=r.Root_3_D;break;case"CL":i=r.CL;break;case"CT":i=r.CT;break;case"CR":i=r.CR;break;case"CB":i=r.CB;break;case"CC":i=r.CC}return i}function Particular_GetPath_Design(n,t){let r=data_layout_design_disease.filter(t=>t.ID==n)[0],i="";switch(t){case"Root_1_U":i=r.Root_1_U;break;case"Root_3_U":i=r.Root_3_U;break;case"Root_1_D":i=r.Root_1_D;break;case"Root_3_D":i=r.Root_3_D}return i}function Particular_Draw_FACEROOT(n,t,r,u){for(i=0;i<CanvasObject.length;i++)if(CanvasObject[i].id==n&&CanvasObject[i].type==""){$("#teethfacetext_"+n).html("");$("#teethfacetext_"+n).css("color","black");$("#teethfacetext_"+n).css("background-color","transparent");let l=CanvasObject[i].face_sign,o=CanvasObject[i].root_sign,s=CanvasObject[i].canvas,e=s.getContext("2d"),h=data_layout_path.filter(n=>n.ID==r)[0],c=data_layout_path.filter(n=>n.ID==u)[0];for(yy=0;yy<t.length;yy++){if(t[yy].area=="root"){let i=t[yy].data;if(i!=undefined&&i.length!=0){let t=new Path2D(h.pathData);for(let r=0;r<i.length;r++)switch(i[r].type){case"color":i[r].having=="1"&&(e.fillStyle=i[r].fill,e.strokeStyle=i[r].stroke,e.fill(t),e.stroke(t));break;case"pattern":if(i[r].having=="1"){let n=new Image;n.src=ser_imageFeature_Disease+i[r].patternlink+".png";n.onload=function(){var i=e.createPattern(n,"repeat");e.fillStyle=i;e.fill(t)}}break;case"image":if(i[r].having=="1"){let n=Particular_GetPath_Image(i[r].imageid,o);var f=new Image;f.src=ser_imageFeature_Disease+n+".svg";f.onload=function(){e.drawImage(f,0,0,40,90)}}break;case"design":if(i[r].having=="1"){let t=Particular_GetPath_Design(i[r].designid,o),n=new Path2D(t);if(e.fillStyle=i[r].fill,e.strokeStyle=i[r].stroke,e.fill(n),e.stroke(n),i[r].ispattern=="1"){let t=new Image;t.src=ser_imageFeature_Disease+i[r].patternlink+".png";t.onload=function(){var i=e.createPattern(t,"repeat");e.fillStyle=i;e.fill(n)}}}break;case"text":i[r].having=="1"&&($("#teethfacetext_"+n).html(i[r].content),$("#teethfacetext_"+n).css("color",i[r].stroke),$("#teethfacetext_"+n).css("background-color",i[r].fill))}}}if(t[yy].area=="face"){let n=t[yy].data;if(n!=undefined&&n.length!=0){let t=new Path2D(c.pathData);for(let i=0;i<n.length;i++)switch(n[i].type){case"color":n[i].having=="1"&&(e.fillStyle=n[i].fill,e.strokeStyle=n[i].stroke,e.fill(t),e.stroke(t));break;case"pattern":if(n[i].having=="1"){let r=new Image;r.src=ser_imageFeature_Disease+n[i].patternlink+".png";r.onload=function(){var n=e.createPattern(r,"repeat");e.fillStyle=n;e.fill(t)}}}}}}i=CanvasObject.length}}function Particular_Draw_CIRCLE(n,t,r,u){for(i=0;i<CanvasObject.length;i++)if(CanvasObject[i].id==n&&CanvasObject[i].type==t){let t=CanvasObject[i].canvas,n=t.getContext("2d");if(u!=undefined&&u.length!=0){n.clearRect(0,0,t.width,t.height);let e=new Path2D(r);for(let t=0;t<u.length;t++)switch(u[t].type){case"color":u[t].having=="1"&&(n.fillStyle=u[t].fill,n.strokeStyle=u[t].stroke,n.fill(e),n.stroke(e));break;case"image":if(u[t].having=="1"){let r=Particular_GetPath_Image(u[t].imageid,CanvasObject[i].path_sign);var f=new Image;f.src=ser_imageFeature_Disease+r+".svg";f.onload=function(){Is_MAC_OS()?n.drawImage(f,0,0,40,90):n.drawImage(f,0,0)}}break;case"pattern":if(u[t].having=="1"){let i=new Image;i.src=ser_imageFeature_Disease+u[t].patternlink+".png";i.onload=function(){var t=n.createPattern(i,"repeat");n.fillStyle=t;n.fill(e)}}}}i=CanvasObject.length}}function Event_Click_Disease(){$(".diseaseitem").mousedown(function(){if(IDTeethFaceSelect.length!=0||IDTeethCircleSelect!=0){let n=$(this).attr("data_id");for(i=0;i<IDTeethFaceSelect.length;i++)_Add_Disease_(n,1,IDTeethFaceSelect[i].id,"","",IDTeethFaceSelect[i].face,IDTeethFaceSelect[i].root);for(i=0;i<IDTeethCircleSelect.length;i++)_Add_Disease_(n,2,IDTeethCircleSelect[i].id,IDTeethCircleSelect[i].type,IDTeethCircleSelect[i].path,"","");IDTeethFaceSelect=[];IDTeethCircleSelect=[];Clear_Selected_Teeth();_Draw_Disease_Design_TEETH_WHOLE();Render_Table_Desease_List(CurrentDisease,"dtContentDisease_DetailBody")}})}function Event_Click_Choose_FR_Teeth(){$(".teeth_part_root_face").mousedown(function(){IDTeethCircleSelect.length!=0&&(IDTeethCircleSelect=[],Clear_Selected_Teeth_Cicle());let n=$(this).attr("data_teeth"),t=$(this).attr("data_face"),r=$(this).attr("data_root");if($(this).hasClass("selectedColorFR"))for($(this).removeClass("selectedColorFR"),i=IDTeethFaceSelect.length-1;i>=0;i--)Number(IDTeethFaceSelect[i].id)==Number(n)&&IDTeethFaceSelect.splice(i,1);else{$(this).addClass("selectedColorFR");let i={};i.id=n;i.face=t;i.root=r;IDTeethFaceSelect.push(i)}ShowHide_Disease_ByType()})}function Event_Click_Choose_Circle_Teeth(){$(".div_circle_all").mousedown(function(){IDTeethFaceSelect.length!=0&&(IDTeethFaceSelect=[],Clear_Selected_Teeth_FC());let n=$(this).attr("data_type"),t=$(this).attr("data_id"),r=$(this).attr("data_path");if($(this).hasClass("selectedColorCircle"))for($(this).removeClass("selectedColorCircle"),i=IDTeethCircleSelect.length-1;i>=0;i--)Number(IDTeethCircleSelect[i].id)==Number(t)&&IDTeethCircleSelect[i].type==n&&IDTeethCircleSelect.splice(i,1);else{$(this).addClass("selectedColorCircle");let i={};i.id=t;i.type=n;i.path=r;IDTeethCircleSelect.push(i)}ShowHide_Disease_ByType()})}function ShowHide_Disease_ByType(){if(IDTeethFaceSelect.length==0&&IDTeethCircleSelect.length!=0){let n=document.getElementsByClassName("diseaseitem");for(zz=0;zz<n.length;zz++)n[zz].attributes.data_type.value=="1"?$("#desease_"+n[zz].attributes.data_id.value).addClass("d-none"):$("#desease_"+n[zz].attributes.data_id.value).removeClass("d-none")}else if(IDTeethCircleSelect.length==0&&IDTeethFaceSelect.length!=0){let n=document.getElementsByClassName("diseaseitem");for(zz=0;zz<n.length;zz++)n[zz].attributes.data_type.value=="2"?$("#desease_"+n[zz].attributes.data_id.value).addClass("d-none"):$("#desease_"+n[zz].attributes.data_id.value).removeClass("d-none")}else{let n=document.getElementsByClassName("disease_for_face_root_teeth");for(zz=0;zz<n.length;zz++)$("#desease_"+n[zz].attributes.data_id.value).removeClass("d-none")}}function Clear_Selected_Teeth_FC(){let n=document.getElementsByClassName("teeth_part_root_face");for(i=0;i<n.length;i++)n[i].className.includes("selectedColorFR")&&(n[i].className="teeth_part_root_face")}function Clear_Selected_Teeth_Cicle(){let n=document.getElementsByClassName("div_circle_all");for(i=0;i<n.length;i++)n[i].className.includes("selectedColorCircle")&&(n[i].className="div_circle_all")}function Clear_Selected_Teeth(){Clear_Selected_Teeth_FC();Clear_Selected_Teeth_Cicle();ShowHide_Disease_ByType()}function Execute_Clear_Draw_One_Teeth(n){for(i=0;i<CanvasObject.length;i++)if(CanvasObject[i].id==n){var t=CanvasObject[i].canvas.getContext("2d");if(t.beginPath(),t.clearRect(0,0,CanvasObject[i].canvas.width,CanvasObject[i].canvas.height),t.fillStyle="#ffffff",t.globalAlpha=.2,t.globalAlpha=1,t.lockMovementX=!0,t.lockMovementY=!0,t.lockScalingX=!0,t.lockScalingY=!0,t.lockUniScaling=!0,t.lockRotation=!0,t.hasControls=!1,t.hasBorders=!1,t.selectable=!0,CanvasObject[i].data_circle==""){let n=data_layout_path.filter(n=>n.ID==CanvasObject[i].data_face)[0],r=data_layout_path.filter(n=>n.ID==CanvasObject[i].data_root)[0];t.strokeStyle=n.strokeColor;t.stroke(new Path2D(n.pathData));t.strokeStyle=r.strokeColor;t.stroke(new Path2D(r.pathData))}else{let n=data_layout_path.filter(n=>n.ID==CanvasObject[i].data_circle)[0];t.strokeStyle=n.strokeColor;t.stroke(new Path2D(n.pathData))}}}function Execute_Draw_Circle(n,t,i,r,u,f){let o=data_layout_path.filter(n=>n.ID==u)[0];t.beginPath();t.clearRect(0,0,n.width,n.height);let e={};e.canvas=n;e.id=i;e.type=r;e.face_sign="";e.root_sign="";e.path_sign=f;e.data_circle=u;e.data_face="";e.data_root="";CanvasObject.push(e);let s=new Path2D(o.pathData);t.globalAlpha=.2;t.globalAlpha=1;t.lockMovementX=!0;t.lockMovementY=!0;t.lockScalingX=!0;t.lockScalingY=!0;t.lockUniScaling=!0;t.lockRotation=!0;t.hasControls=!1;t.hasBorders=!1;t.selectable=!0;t.strokeStyle=o.strokeColor;t.fillStyle=o.fillColor;t.fill(s);t.stroke(s)}function Execute_Draw_Whole_Teeth(){$(".canvasTeethFace").each(function(){var n=new fabric.Canvas(this.id),r=n.getContext("2d");let t=$(this).attr("data_face"),i=$(this).attr("data_root"),u=$(this).attr("data_id"),f=data_layout_path.filter(n=>n.ID==t)[0],e=data_layout_path.filter(n=>n.ID==i)[0];Execute_Draw_FR_Teeth(n,r,u,t,i,f.Sign,e.Sign)});$(".canvasTeethCircle").each(function(){var n=new fabric.Canvas(this.id),i=n.getContext("2d");let t=$(this).attr("data_path"),r=$(this).attr("data_type"),u=$(this).attr("data_id"),f=data_layout_path.filter(n=>n.ID==t)[0];Execute_Draw_Circle(n,i,u,r,t,f.Sign)})}function Execute_Draw_FR_Teeth(n,t,i,r,u,f,e){let s=data_layout_path.filter(n=>n.ID==r)[0],h=data_layout_path.filter(n=>n.ID==u)[0],o={};o.canvas=n;o.id=i;o.type="";o.face_sign=f;o.root_sign=e;o.path_sign="";o.data_circle="";o.data_face=r;o.data_root=u;CanvasObject.push(o);let c=new Path2D(s.pathData),l=new Path2D(h.pathData);t.clearRect(0,0,40,90);t.globalAlpha=.2;t.fillStyle="white";t.fillRect(0,0,40,90);t.globalAlpha=1;t.lockMovementX=!0;t.lockMovementY=!0;t.lockScalingX=!0;t.lockScalingY=!0;t.lockUniScaling=!0;t.lockRotation=!0;t.hasControls=!1;t.hasBorders=!1;t.selectable=!0;t.strokeStyle=s.strokeColor;t.fillStyle=s.fillColor;t.fill(c);t.stroke(c);t.strokeStyle=h.strokeColor;t.fillStyle=h.fillColor;t.fill(l);t.stroke(l)}function Render_Disease_Teeh(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="",f="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i];f='<li id="desease_'+t.ID+'" data_type="'+t.Type+'" data_id="'+t.ID+'" class="diseaseitem list-group-item border-0 d-flex justify-content-between ps-2 mb-2 border-radius-lg"><div class="d-flex align-items-center"><div class="me-3 text-center"><img style="height: 30px;width: 30px;" title="'+t.DescriptionTip+'" src="'+ser_imageFeature_Disease+t.ImageFeature+'.png" alt="label-image"><\/div><div class="d-flex flex-column"><h6 class="mb-1 text-dark text-sm">'+t.Name+'<\/h6><span class="text-xs">'+t.DescriptionTip+"<\/span><\/div><\/div><\/li>";u=u+f}document.getElementById(t).innerHTML=u}Event_Click_Disease()}function Render_Table_Desease_List(n,t){var r=document.getElementById(t),i;if(r!=null){r.innerHTML="";let u="";if(n&&n.length>0)for(i=0;i<n.length;i++){let t=n[i],f=data_layout_teeth.filter(n=>n.ID==t.teethid),r=f[0].TeethName,e='<td class="d-none">'+t.diseaseid+'<\/td><td class="d-none">'+t.teethid+'<\/td><td class="d-none">'+t.type+'<\/td><td class="d-none">'+t.typecircle+'<\/td><td class="d-none">'+t.userid+'<\/td><td class="vt-number-order"><\/td><td><span>'+t.updatetime+"<\/span><\/td><td>"+(t.typecircle!=""?r+" ( "+t.typecircle.toUpperCase()+" )":r)+"<\/td><td>"+t.diseasename+"<\/td><td>"+AddCell_Treat_Teeth(t.proposed_treat,t.typecircle,t.type,t.diseaseid,t.teethid)+"<\/td><td>"+AddCell_Classification(t.classification,t.typecircle,t.type,t.diseaseid,t.teethid)+"<\/td><td>"+AddCell_Note_Teeth(t.note,t.typecircle,t.type,t.diseaseid,t.teethid)+"<\/td>"+(t.DeleteButton===1?'<td><i data_typecircle="'+t.typecircle+'" data_type="'+t.type+'" data_disease="'+t.diseaseid+'" data_teethid="'+t.teethid+'" class="deleteDisease vtt-icon vttech-icon-delete"><\/i> <\/td>':"<td><\/td>");u=u+'<tr role="row" class="vt-number">'+e+"<\/tr>"}document.getElementById(t).innerHTML=u}Event_Click_Status_List();Fill_data_class_To_Design();Event_Text_Change_NoteTeeth();$("#dtContentDisease_Detail").tablesort();$("#dtContentDisease_Detail .ui.dropdown").dropdown({onShow:function(){let n=$(this);Dropdown_Set_Position(n)},onHide:function(){let n=$(this);Dropdown_Remove_Position(n)},allowCategorySelection:!0,forceSelection:!1})}function AddCell_Note_Teeth(n,t,i,r,u){return'<input data_typecircle="'+t+'" data_type="'+i+'" data_disease="'+r+'" data_teethid="'+u+'" class="form-control noteDiseaseTeeth" placeholder="eg .'+Outlang.Ghi_chu+'"  type="text"  value="'+n+'">'}function AddCell_Treat_Teeth(n,t,i,r,u){return'<input data_typecircle="'+t+'" data_type="'+i+'" data_disease="'+r+'" data_teethid="'+u+'" class="form-control treatDiseaseTeeth" placeholder="eg .'+Outlang.Dieu_tri+'" type="text"  value="'+n+'">'}function AddCell_Classification(n,t,r,u,f){let o="classDiseaseTeeth_"+t+"_"+r+"_"+u+"_"+f,e='<div data_typecircle="'+t+'" data_type="'+r+'" data_disease="'+u+'" data_teethid="'+f+'" class="ui fluid search selection dropdown form-control classDiseaseTeeth" id='+o+'><input type="hidden"/><i class="dropdown icon"><\/i><input  class="search" autocomplete="off" tabindex="0" /><div class="default text">eg .'+Outlang.Phan_loai+'<\/div><div class="menu" tabindex="-1">';for(i=0;i<ser_classification_date.length;i++)e=e+'<div class="item" data-value='+ser_classification_date[i].ID+">"+ser_classification_date[i].Name+"<\/div>";return e+"<\/div>"}function Fill_data_class_To_Design(){for(ii=0;ii<CurrentDisease.length;ii++){let n="classDiseaseTeeth_"+CurrentDisease[ii].typecircle+"_"+CurrentDisease[ii].type+"_"+CurrentDisease[ii].diseaseid+"_"+CurrentDisease[ii].teethid;$("#"+n).length&&($("#"+n).dropdown("refresh"),$("#"+n).dropdown("set selected",CurrentDisease[ii].classification))}}function Event_Click_Status_List(){$(".deleteDisease").click(function(){let i=$(this).attr("data_disease"),n=$(this).attr("data_teethid"),t=$(this).attr("data_type"),r=$(this).attr("data_typecircle");for(iiii=CurrentDisease.length-1;iiii>=0;iiii--)if(CurrentDisease[iiii].diseaseid==i&&CurrentDisease[iiii].teethid==n&&CurrentDisease[iiii].type==t&&CurrentDisease[iiii].typecircle==r){CurrentDisease.splice(iiii,1);break}Clear_Selected_Teeth();Execute_Clear_Draw_One_Teeth(n,t);_Draw_Disease_Design_TEETH_WHOLE();Render_Table_Desease_List(CurrentDisease,"dtContentDisease_DetailBody");$("#teethfacetext_"+n).html("");$("#teethfacetext_"+n).css("color","black");$("#teethfacetext_"+n).css("background-color","transparent")})}function Event_Text_Change_NoteTeeth(){$(".treatDiseaseTeeth").change(function(){let n=$(this).attr("data_disease"),t=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_typecircle");for(ii=0;ii<CurrentDisease.length;ii++)CurrentDisease[ii].type==i&&CurrentDisease[ii].teethid==t&&CurrentDisease[ii].diseaseid==n&&CurrentDisease[ii].typecircle==r&&(CurrentDisease[ii].proposed_treat=$(this).val(),ii=CurrentDisease.length)});$(".noteDiseaseTeeth").change(function(){let n=$(this).attr("data_disease"),t=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_typecircle");for(ii=0;ii<CurrentDisease.length;ii++)CurrentDisease[ii].type==i&&CurrentDisease[ii].teethid==t&&CurrentDisease[ii].diseaseid==n&&CurrentDisease[ii].typecircle==r&&(CurrentDisease[ii].note=$(this).val(),ii=CurrentDisease.length)});$(".classDiseaseTeeth").unbind("change").change(function(){let n=$(this).attr("data_disease"),t=$(this).attr("data_teethid"),i=$(this).attr("data_type"),r=$(this).attr("data_typecircle");for(ii=0;ii<CurrentDisease.length;ii++)if(CurrentDisease[ii].type==i&&CurrentDisease[ii].teethid==t&&CurrentDisease[ii].diseaseid==n&&CurrentDisease[ii].typecircle==r){let n=$(this).dropdown("get value");n!=undefined&&(CurrentDisease[ii].classification=n,ii=CurrentDisease.length)}});$(".ui.dropdown").dropdown({allowCategorySelection:!0,forceSelection:!1})}